{"remainingRequest":"/Users/kscissorfootdoctor/Desktop/Book_Web_App/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/kscissorfootdoctor/Desktop/Book_Web_App/src/components/ebook/EbookBookMark.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/kscissorfootdoctor/Desktop/Book_Web_App/src/components/ebook/EbookBookMark.vue","mtime":1587319660810},{"path":"/Users/kscissorfootdoctor/Desktop/Book_Web_App/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/kscissorfootdoctor/Desktop/Book_Web_App/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/kscissorfootdoctor/Desktop/Book_Web_App/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/kscissorfootdoctor/Desktop/Book_Web_App/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IHJlYWxQeCB9IGZyb20gIi4uLy4uL3V0aWxzL3V0aWxzLmpzIjsKaW1wb3J0IHsgZWJvb2tNaW54IH0gZnJvbSAiLi4vLi4vdXRpbHMvbWl4aW4uanMiOwppbXBvcnQgQm9va21hcmsgZnJvbSAiLi4vY29tbW9uL0Jvb2ttYXJrLnZ1ZSI7CmltcG9ydCB7IGdldEJvb2ttYXJrLCBzYXZlQm9va21hcmsgfSBmcm9tICIuLi8uLi91dGlscy9sb2NhbHN0b3JhZ2UuanMiOwpjb25zdCBCTFVFID0gIiMzNDZjYmMiOwpjb25zdCBXSElURSA9ICIjZmZmZmZmIjsKZXhwb3J0IGRlZmF1bHQgewogIG1peGluczogW2Vib29rTWlueF0sCiAgY29tcG9uZW50czogeyBCb29rbWFyayB9LAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICB0ZXh0OiAiIiwKICAgICAgY29sb3I6IFdISVRFLAogICAgICBpc0ZpeGVkOiBmYWxzZQogICAgfTsKICB9LAogIGNvbXB1dGVkOiB7CiAgICBoZWlnaHQoKSB7CiAgICAgIHJldHVybiByZWFsUHgoMzUpOwogICAgfSwKICAgIHRocmVzaG9sZCgpIHsKICAgICAgcmV0dXJuIHJlYWxQeCg1NSk7CiAgICB9LAogICAgRml4ZWRTdHlsZSgpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBwb3NpdGlvbjogImZpeGVkIiwKICAgICAgICB0b3A6ICIwIiwKICAgICAgICByaWdodDogYCR7KHdpbmRvdy5pbm5lcldpZHRoIC0gdGhpcy4kcmVmcy5ib29rbWFyay5jbGllbnRXaWR0aCkgLyAyfWAKICAgICAgfTsKICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIGJlZm9yZUhlaWdodCh2KSB7CiAgICAgIC8vIHN0YXRlT25lCiAgICAgIGlmICh0aGlzLmlzQm9va21hcmspIHsKICAgICAgICB0aGlzLnRleHQgPSB0aGlzLiR0KCJib29rLnB1bGxkb3duRGVsZXRlTWFyayIpOwogICAgICAgIHRoaXMuY29sb3IgPSBCTFVFOwogICAgICAgIHRoaXMuaXNGaXhlZCA9IHRydWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy50ZXh0ID0gdGhpcy4kdCgiYm9vay5wdWxsZG93bkFkZE1hcmsiKTsKICAgICAgICB0aGlzLmNvbG9yID0gV0hJVEU7CiAgICAgICAgdGhpcy5pc0ZpeGVkID0gZmFsc2U7CiAgICAgIH0KICAgIH0sCiAgICBiZWZvcmVUaHJlc2hvbGQodikgewogICAgICAvLyBzdGF0ZVR3bwogICAgICB0aGlzLiRyZWZzLmJvb2ttYXJrLnN0eWxlLnRvcCA9IGAkey12fXB4YDsKICAgICAgaWYgKHRoaXMuaXNCb29rbWFyaykgewogICAgICAgIHRoaXMudGV4dCA9IHRoaXMuJHQoImJvb2sucHVsbGRvd25EZWxldGVNYXJrIik7CiAgICAgICAgdGhpcy5jb2xvciA9IEJMVUU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy50ZXh0ID0gdGhpcy4kdCgiYm9vay5wdWxsZG93bkFkZE1hcmsiKTsKICAgICAgICB0aGlzLmNvbG9yID0gV0hJVEU7CiAgICAgIH0KCiAgICAgIGNvbnN0IGljb25Eb3duID0gdGhpcy4kcmVmcy5pY29uZG93bjsKICAgICAgaWYgKGljb25Eb3duLnN0eWxlLnRyYW5zZm9ybSA9PT0gInJvdGF0ZSgxODBkZWcpIikgewogICAgICAgIGljb25Eb3duLnN0eWxlLnRyYW5zZm9ybSA9ICJyb3RhdGUoMGRlZykiOwogICAgICB9CiAgICB9LAogICAgYWZ0ZXJUaHJlc2hvbGQodikgewogICAgICAvLyBzdGF0ZVRocmVlCiAgICAgIHRoaXMuJHJlZnMuYm9va21hcmsuc3R5bGUudG9wID0gYCR7LXZ9cHhgOwogICAgICBpZiAodGhpcy5pc0Jvb2ttYXJrKSB7CiAgICAgICAgdGhpcy50ZXh0ID0gdGhpcy4kdCgiYm9vay5yZWxlYXNlRGVsZXRlTWFyayIpOwogICAgICAgIHRoaXMuaXNGaXhlZCA9IGZhbHNlOwogICAgICAgIHRoaXMuY29sb3IgPSBXSElURTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnRleHQgPSB0aGlzLiR0KCJib29rLnJlbGVhc2VBZGRNYXJrIik7CiAgICAgICAgdGhpcy5pc0ZpeGVkID0gdHJ1ZTsKICAgICAgICB0aGlzLmNvbG9yID0gQkxVRTsKICAgICAgfQogICAgICBjb25zdCBpY29uRG93biA9IHRoaXMuJHJlZnMuaWNvbmRvd247CiAgICAgIGlmICgKICAgICAgICBpY29uRG93bi5zdHlsZS50cmFuc2Zvcm0gPT09ICIiIHx8CiAgICAgICAgaWNvbkRvd24uc3R5bGUudHJhbnNmb3JtID09PSAicm90YXRlKDBkZWcpIgogICAgICApIHsKICAgICAgICBpY29uRG93bi5zdHlsZS50cmFuc2Zvcm0gPSAicm90YXRlKDE4MGRlZykiOwogICAgICB9CiAgICB9LAogICAgcmVzdG9yZSgpIHsKICAgICAgLy8gc3RhdGVGb3VyCiAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgIHRoaXMuJHJlZnMuYm9va21hcmsuc3R5bGUudG9wID0gYCR7LXRoaXMuaGVpZ2h0fXB4YDsKICAgICAgICB0aGlzLiRyZWZzLmljb25kb3duLnN0eWxlLnRyYW5zZm9ybSA9ICJyb3RhdGUoMGRlZykiOwogICAgICB9LCAyMDApOwogICAgICBpZiAodGhpcy5pc0ZpeGVkKSB7CiAgICAgICAgdGhpcy5zZXRJc0Jvb2ttYXJrKHRydWUpOwogICAgICAgIHRoaXMuYWRkQm9va21hcmsoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNldElzQm9va21hcmsoZmFsc2UpOwogICAgICAgIHRoaXMucmVtb3ZlQm9va21hcmsoKTsKICAgICAgfQogICAgfSwKICAgIGFkZEJvb2ttYXJrKCkgewogICAgICB0aGlzLmJvb2ttYXJrID0gZ2V0Qm9va21hcmsodGhpcy5maWxlTmFtZSk7CiAgICAgIGlmICghdGhpcy5ib29rbWFyaykgewogICAgICAgIHRoaXMuYm9va21hcmsgPSBbXTsKICAgICAgICBjb25zb2xlLmxvZyh0aGlzLmJvb2ttYXJrKTsKICAgICAgfQogICAgICBjb25zdCBjdXJyZW50TG9jYXRpb24gPSB0aGlzLmN1cnJlbnRCb29rLnJlbmRpdGlvbi5jdXJyZW50TG9jYXRpb24oKTsKICAgICAgY29uc3QgY2ZpQmFzZSA9IGN1cnJlbnRMb2NhdGlvbi5zdGFydC5jZmkucmVwbGFjZSgvIS4qLywgIiIpOwogICAgICBjb25zdCBjZmlTdGFydCA9IGN1cnJlbnRMb2NhdGlvbi5zdGFydC5jZmkKICAgICAgICAucmVwbGFjZSgvLiohLywgIiIpCiAgICAgICAgLnJlcGxhY2UoL1wpJC8sICIiKTsKICAgICAgY29uc3QgY2ZpRW5kID0gY3VycmVudExvY2F0aW9uLmVuZC5jZmkKICAgICAgICAucmVwbGFjZSgvLiohLywgIiIpCiAgICAgICAgLnJlcGxhY2UoL1wpJC8sICIiKTsKICAgICAgY29uc3QgY2ZpUmFuZ2UgPSBgJHtjZmlCYXNlfSEsJHtjZmlTdGFydH0sJHtjZmlFbmR9KWA7CiAgICAgIHRoaXMuY3VycmVudEJvb2suZ2V0UmFuZ2UoY2ZpUmFuZ2UpLnRoZW4ocmFuZ2UgPT4gewogICAgICAgIGNvbnN0IHRleHQgPSByYW5nZS50b1N0cmluZygpLnJlcGxhY2UoL1xzXHMvZywgIiIpOwogICAgICAgIGNvbnNvbGUubG9nKHRoaXMuYm9va21hcmspOwogICAgICAgIHRoaXMuYm9va21hcmsucHVzaCh7CiAgICAgICAgICBjZmk6IGN1cnJlbnRMb2NhdGlvbi5zdGFydC5jZmksCiAgICAgICAgICB0ZXh0OiB0ZXh0CiAgICAgICAgfSk7CiAgICAgICAgc2F2ZUJvb2ttYXJrKHRoaXMuZmlsZU5hbWUsIHRoaXMuYm9va21hcmspOwogICAgICB9KTsKICAgIH0sCiAgICByZW1vdmVCb29rbWFyaygpIHsKICAgICAgY29uc3QgY3VycmVudExvY2F0aW9uID0gdGhpcy5jdXJyZW50Qm9vay5yZW5kaXRpb24uY3VycmVudExvY2F0aW9uKCk7CiAgICAgIGNvbnN0IGNmaSA9IGN1cnJlbnRMb2NhdGlvbi5zdGFydC5jZmk7CiAgICAgIHRoaXMuYm9va21hcmsgPSBnZXRCb29rbWFyayh0aGlzLmZpbGVOYW1lKTsKICAgICAgaWYgKHRoaXMuYm9va21hcmspIHsKICAgICAgICB0aGlzLmJvb2ttYXJrID0gdGhpcy5ib29rbWFyay5maWx0ZXIoaXRlbSA9PiBpdGVtLmNmaSAhPT0gY2ZpKTsKICAgICAgICBzYXZlQm9va21hcmsodGhpcy5maWxlTmFtZSwgdGhpcy5ib29rbWFyayk7CiAgICAgICAgdGhpcy5zZXRJc0Jvb2ttYXJrKGZhbHNlKTsKICAgICAgfQogICAgfQogIH0sCiAgd2F0Y2g6IHsKICAgIG9mZnNldFkodikgewogICAgICBpZiAodiA9PT0gMCkgewogICAgICAgIHRoaXMucmVzdG9yZSgpOwogICAgICB9CiAgICAgIGlmICh2ID49IHRoaXMuaGVpZ2h0ICYmIHYgPD0gdGhpcy50aHJlc2hvbGQpIHsKICAgICAgICB0aGlzLmJlZm9yZVRocmVzaG9sZCh2KTsKICAgICAgfSBlbHNlIGlmICh2ID49IHRoaXMudGhyZXNob2xkKSB7CiAgICAgICAgdGhpcy5hZnRlclRocmVzaG9sZCh2KTsKICAgICAgfSBlbHNlIGlmICh2ID4gMCAmJiB2IDw9IHRoaXMuaGVpZ2h0KSB7CiAgICAgICAgdGhpcy5iZWZvcmVIZWlnaHQodik7CiAgICAgIH0KICAgIH0sCiAgICBpc0Jvb2ttYXJrKGlzQm9va21hcmspIHsKICAgICAgaWYgKGlzQm9va21hcmspIHsKICAgICAgICB0aGlzLmNvbG9yID0gQkxVRTsKICAgICAgfQogICAgfQogIH0KfTsK"},{"version":3,"sources":["EbookBookMark.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;AAeA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"EbookBookMark.vue","sourceRoot":"src/components/ebook","sourcesContent":["<template>\n  <div class=\"ebook-bookmark\" ref=\"bookmark\">\n    <div class=\"ebook-bookmark-text-wrapper\">\n      <div class=\"ebook-bookmark-down-wrapper\" ref=\"icondown\">\n        <span class=\"icon-down\"></span>\n      </div>\n      <div class=\"ebook-bookmark-text\">{{text}}</div>\n    </div>\n    <div class=\"ebook-bookmark-icon-wrapper\" :style=\"isFixed?FixedStyle:{}\">\n      <Bookmark :color=\"color\" :width=\"15\" :height=\"35\"></Bookmark>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { realPx } from \"../../utils/utils.js\";\nimport { ebookMinx } from \"../../utils/mixin.js\";\nimport Bookmark from \"../common/Bookmark.vue\";\nimport { getBookmark, saveBookmark } from \"../../utils/localstorage.js\";\nconst BLUE = \"#346cbc\";\nconst WHITE = \"#ffffff\";\nexport default {\n  mixins: [ebookMinx],\n  components: { Bookmark },\n  data() {\n    return {\n      text: \"\",\n      color: WHITE,\n      isFixed: false\n    };\n  },\n  computed: {\n    height() {\n      return realPx(35);\n    },\n    threshold() {\n      return realPx(55);\n    },\n    FixedStyle() {\n      return {\n        position: \"fixed\",\n        top: \"0\",\n        right: `${(window.innerWidth - this.$refs.bookmark.clientWidth) / 2}`\n      };\n    }\n  },\n  methods: {\n    beforeHeight(v) {\n      // stateOne\n      if (this.isBookmark) {\n        this.text = this.$t(\"book.pulldownDeleteMark\");\n        this.color = BLUE;\n        this.isFixed = true;\n      } else {\n        this.text = this.$t(\"book.pulldownAddMark\");\n        this.color = WHITE;\n        this.isFixed = false;\n      }\n    },\n    beforeThreshold(v) {\n      // stateTwo\n      this.$refs.bookmark.style.top = `${-v}px`;\n      if (this.isBookmark) {\n        this.text = this.$t(\"book.pulldownDeleteMark\");\n        this.color = BLUE;\n      } else {\n        this.text = this.$t(\"book.pulldownAddMark\");\n        this.color = WHITE;\n      }\n\n      const iconDown = this.$refs.icondown;\n      if (iconDown.style.transform === \"rotate(180deg)\") {\n        iconDown.style.transform = \"rotate(0deg)\";\n      }\n    },\n    afterThreshold(v) {\n      // stateThree\n      this.$refs.bookmark.style.top = `${-v}px`;\n      if (this.isBookmark) {\n        this.text = this.$t(\"book.releaseDeleteMark\");\n        this.isFixed = false;\n        this.color = WHITE;\n      } else {\n        this.text = this.$t(\"book.releaseAddMark\");\n        this.isFixed = true;\n        this.color = BLUE;\n      }\n      const iconDown = this.$refs.icondown;\n      if (\n        iconDown.style.transform === \"\" ||\n        iconDown.style.transform === \"rotate(0deg)\"\n      ) {\n        iconDown.style.transform = \"rotate(180deg)\";\n      }\n    },\n    restore() {\n      // stateFour\n      setTimeout(() => {\n        this.$refs.bookmark.style.top = `${-this.height}px`;\n        this.$refs.icondown.style.transform = \"rotate(0deg)\";\n      }, 200);\n      if (this.isFixed) {\n        this.setIsBookmark(true);\n        this.addBookmark();\n      } else {\n        this.setIsBookmark(false);\n        this.removeBookmark();\n      }\n    },\n    addBookmark() {\n      this.bookmark = getBookmark(this.fileName);\n      if (!this.bookmark) {\n        this.bookmark = [];\n        console.log(this.bookmark);\n      }\n      const currentLocation = this.currentBook.rendition.currentLocation();\n      const cfiBase = currentLocation.start.cfi.replace(/!.*/, \"\");\n      const cfiStart = currentLocation.start.cfi\n        .replace(/.*!/, \"\")\n        .replace(/\\)$/, \"\");\n      const cfiEnd = currentLocation.end.cfi\n        .replace(/.*!/, \"\")\n        .replace(/\\)$/, \"\");\n      const cfiRange = `${cfiBase}!,${cfiStart},${cfiEnd})`;\n      this.currentBook.getRange(cfiRange).then(range => {\n        const text = range.toString().replace(/\\s\\s/g, \"\");\n        console.log(this.bookmark);\n        this.bookmark.push({\n          cfi: currentLocation.start.cfi,\n          text: text\n        });\n        saveBookmark(this.fileName, this.bookmark);\n      });\n    },\n    removeBookmark() {\n      const currentLocation = this.currentBook.rendition.currentLocation();\n      const cfi = currentLocation.start.cfi;\n      this.bookmark = getBookmark(this.fileName);\n      if (this.bookmark) {\n        this.bookmark = this.bookmark.filter(item => item.cfi !== cfi);\n        saveBookmark(this.fileName, this.bookmark);\n        this.setIsBookmark(false);\n      }\n    }\n  },\n  watch: {\n    offsetY(v) {\n      if (v === 0) {\n        this.restore();\n      }\n      if (v >= this.height && v <= this.threshold) {\n        this.beforeThreshold(v);\n      } else if (v >= this.threshold) {\n        this.afterThreshold(v);\n      } else if (v > 0 && v <= this.height) {\n        this.beforeHeight(v);\n      }\n    },\n    isBookmark(isBookmark) {\n      if (isBookmark) {\n        this.color = BLUE;\n      }\n    }\n  }\n};\n</script>\n\n<style lang=\"scss\" scoped>\n@import \"../../assets/styles/global.scss\";\n.ebook-bookmark {\n  position: absolute;\n  top: px2rem(-35);\n  left: 0;\n  width: 100%;\n  height: px2rem(35);\n  z-index: 200;\n  .ebook-bookmark-text-wrapper {\n    position: absolute;\n    right: px2rem(45);\n    bottom: 0;\n    display: flex;\n    .ebook-bookmark-down-wrapper {\n      font-size: px2rem(14);\n      color: white;\n      transition: all 0.2s linear;\n      @include center;\n    }\n    .ebook-bookmark-text {\n      font-size: px2rem(14);\n      color: white;\n    }\n  }\n  .ebook-bookmark-icon-wrapper {\n    position: absolute;\n    right: 0;\n    bottom: 0;\n    margin-right: px2rem(15);\n  }\n}\n</style>\n"]}]}