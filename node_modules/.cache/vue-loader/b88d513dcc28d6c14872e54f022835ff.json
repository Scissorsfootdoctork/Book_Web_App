{"remainingRequest":"/Users/kscissorfootdoctor/Desktop/Book_Web_App/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/kscissorfootdoctor/Desktop/Book_Web_App/src/components/ebook/EbookBookMark.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/kscissorfootdoctor/Desktop/Book_Web_App/src/components/ebook/EbookBookMark.vue","mtime":1589128909822},{"path":"/Users/kscissorfootdoctor/Desktop/Book_Web_App/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/kscissorfootdoctor/Desktop/Book_Web_App/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/kscissorfootdoctor/Desktop/Book_Web_App/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/kscissorfootdoctor/Desktop/Book_Web_App/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IHJlYWxQeCB9IGZyb20gJy4uLy4uL3V0aWxzL3V0aWxzLmpzJwppbXBvcnQgeyBlYm9va01pbnggfSBmcm9tICcuLi8uLi91dGlscy9taXhpbi5qcycKaW1wb3J0IEJvb2ttYXJrIGZyb20gJy4uL2NvbW1vbi9Cb29rbWFyay52dWUnCmltcG9ydCB7IGdldEJvb2ttYXJrLCBzYXZlQm9va21hcmsgfSBmcm9tICcuLi8uLi91dGlscy9sb2NhbHN0b3JhZ2UuanMnCgpjb25zdCBCTFVFID0gJyMzNDZjYmMnCmNvbnN0IFdISVRFID0gJyNmZmZmZmYnCmV4cG9ydCBkZWZhdWx0IHsKICBtaXhpbnM6IFtlYm9va01pbnhdLAogIGNvbXBvbmVudHM6IHsKICAgIEJvb2ttYXJrCiAgfSwKICBkYXRhICgpIHsKICAgIHJldHVybiB7CiAgICAgIHRleHQ6ICcnLAogICAgICBjb2xvcjogV0hJVEUsCiAgICAgIGlzRml4ZWQ6IGZhbHNlCiAgICB9CiAgfSwKICBjb21wdXRlZDogewogICAgaGVpZ2h0ICgpIHsKICAgICAgcmV0dXJuIHJlYWxQeCgzNSkKICAgIH0sCiAgICB0aHJlc2hvbGQgKCkgewogICAgICByZXR1cm4gcmVhbFB4KDU1KQogICAgfSwKICAgIEZpeGVkU3R5bGUgKCkgewogICAgICByZXR1cm4gewogICAgICAgIHBvc2l0aW9uOiAnZml4ZWQnLAogICAgICAgIHRvcDogJzAnLAogICAgICAgIHJpZ2h0OiBgJHsod2luZG93LmlubmVyV2lkdGggLSB0aGlzLiRyZWZzLmJvb2ttYXJrLmNsaWVudFdpZHRoKSAvIDJ9YAogICAgICB9CiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICBiZWZvcmVIZWlnaHQgKHYpIHsKICAgICAgLy8gc3RhdGVPbmUKICAgICAgaWYgKHRoaXMuaXNCb29rbWFyaykgewogICAgICAgIHRoaXMudGV4dCA9IHRoaXMuJHQoJ2Jvb2sucHVsbGRvd25EZWxldGVNYXJrJykKICAgICAgICB0aGlzLmNvbG9yID0gQkxVRQogICAgICAgIHRoaXMuaXNGaXhlZCA9IHRydWUKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnRleHQgPSB0aGlzLiR0KCdib29rLnB1bGxkb3duQWRkTWFyaycpCiAgICAgICAgdGhpcy5jb2xvciA9IFdISVRFCiAgICAgICAgdGhpcy5pc0ZpeGVkID0gZmFsc2UKICAgICAgfQogICAgfSwKICAgIGJlZm9yZVRocmVzaG9sZCAodikgewogICAgICAvLyBzdGF0ZVR3bwogICAgICB0aGlzLiRyZWZzLmJvb2ttYXJrLnN0eWxlLnRvcCA9IGAkey12fXB4YAogICAgICBpZiAodGhpcy5pc0Jvb2ttYXJrKSB7CiAgICAgICAgdGhpcy50ZXh0ID0gdGhpcy4kdCgnYm9vay5wdWxsZG93bkRlbGV0ZU1hcmsnKQogICAgICAgIHRoaXMuY29sb3IgPSBCTFVFCiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy50ZXh0ID0gdGhpcy4kdCgnYm9vay5wdWxsZG93bkFkZE1hcmsnKQogICAgICAgIHRoaXMuY29sb3IgPSBXSElURQogICAgICB9CgogICAgICBjb25zdCBpY29uRG93biA9IHRoaXMuJHJlZnMuaWNvbmRvd24KICAgICAgaWYgKGljb25Eb3duLnN0eWxlLnRyYW5zZm9ybSA9PT0gJ3JvdGF0ZSgxODBkZWcpJykgewogICAgICAgIGljb25Eb3duLnN0eWxlLnRyYW5zZm9ybSA9ICdyb3RhdGUoMGRlZyknCiAgICAgIH0KICAgIH0sCiAgICBhZnRlclRocmVzaG9sZCAodikgewogICAgICAvLyBzdGF0ZVRocmVlCiAgICAgIHRoaXMuJHJlZnMuYm9va21hcmsuc3R5bGUudG9wID0gYCR7LXZ9cHhgCiAgICAgIGlmICh0aGlzLmlzQm9va21hcmspIHsKICAgICAgICB0aGlzLnRleHQgPSB0aGlzLiR0KCdib29rLnJlbGVhc2VEZWxldGVNYXJrJykKICAgICAgICB0aGlzLmlzRml4ZWQgPSBmYWxzZQogICAgICAgIHRoaXMuY29sb3IgPSBXSElURQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMudGV4dCA9IHRoaXMuJHQoJ2Jvb2sucmVsZWFzZUFkZE1hcmsnKQogICAgICAgIHRoaXMuaXNGaXhlZCA9IHRydWUKICAgICAgICB0aGlzLmNvbG9yID0gQkxVRQogICAgICB9CiAgICAgIGNvbnN0IGljb25Eb3duID0gdGhpcy4kcmVmcy5pY29uZG93bgogICAgICBpZiAoCiAgICAgICAgaWNvbkRvd24uc3R5bGUudHJhbnNmb3JtID09PSAnJyB8fAogICAgICAgIGljb25Eb3duLnN0eWxlLnRyYW5zZm9ybSA9PT0gJ3JvdGF0ZSgwZGVnKScKICAgICAgKSB7CiAgICAgICAgaWNvbkRvd24uc3R5bGUudHJhbnNmb3JtID0gJ3JvdGF0ZSgxODBkZWcpJwogICAgICB9CiAgICB9LAogICAgcmVzdG9yZSAoKSB7CiAgICAgIC8vIHN0YXRlRm91cgogICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICB0aGlzLiRyZWZzLmJvb2ttYXJrLnN0eWxlLnRvcCA9ICckIHsgLXRoaXMuaGVpZ2h0IH1weCcKICAgICAgICB0aGlzLiRyZWZzLmljb25kb3duLnN0eWxlLnRyYW5zZm9ybSA9ICdyb3RhdGUoMGRlZyknCiAgICAgIH0sIDIwMCkKICAgICAgaWYgKHRoaXMuaXNGaXhlZCkgewogICAgICAgIHRoaXMuc2V0SXNCb29rbWFyayh0cnVlKQogICAgICAgIHRoaXMuYWRkQm9va21hcmsoKQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc2V0SXNCb29rbWFyayhmYWxzZSkKICAgICAgICB0aGlzLnJlbW92ZUJvb2ttYXJrKCkKICAgICAgfQogICAgfSwKICAgIGFkZEJvb2ttYXJrICgpIHsKICAgICAgdGhpcy5ib29rbWFyayA9IGdldEJvb2ttYXJrKHRoaXMuZmlsZU5hbWUpCiAgICAgIGlmICghdGhpcy5ib29rbWFyaykgewogICAgICAgIHRoaXMuYm9va21hcmsgPSBbXQogICAgICB9CiAgICAgIGNvbnN0IGN1cnJlbnRMb2NhdGlvbiA9IHRoaXMuY3VycmVudEJvb2sucmVuZGl0aW9uLmN1cnJlbnRMb2NhdGlvbigpCiAgICAgIGNvbnN0IGNmaUJhc2UgPSBjdXJyZW50TG9jYXRpb24uc3RhcnQuY2ZpLnJlcGxhY2UoLyEuKi8sICcnKQogICAgICBjb25zdCBjZmlTdGFydCA9IGN1cnJlbnRMb2NhdGlvbi5zdGFydC5jZmkKICAgICAgICAucmVwbGFjZSgvLiohLywgJycpCiAgICAgICAgLnJlcGxhY2UoL1wpJC8sICcnKQogICAgICBjb25zdCBjZmlFbmQgPSBjdXJyZW50TG9jYXRpb24uZW5kLmNmaQogICAgICAgIC5yZXBsYWNlKC8uKiEvLCAnJykKICAgICAgICAucmVwbGFjZSgvXCkkLywgJycpCiAgICAgIGNvbnN0IGNmaVJhbmdlID0gYCR7Y2ZpQmFzZX0hLCR7Y2ZpU3RhcnR9LCR7Y2ZpRW5kfSlgCiAgICAgIHRoaXMuY3VycmVudEJvb2suZ2V0UmFuZ2UoY2ZpUmFuZ2UpLnRoZW4ocmFuZ2UgPT4gewogICAgICAgIGNvbnN0IHRleHQgPSByYW5nZS50b1N0cmluZygpLnJlcGxhY2UoL1xzXHMvZywgJycpCiAgICAgICAgdGhpcy5ib29rbWFyay5wdXNoKHsKICAgICAgICAgIGNmaTogY3VycmVudExvY2F0aW9uLnN0YXJ0LmNmaSwKICAgICAgICAgIHRleHQ6IHRleHQKICAgICAgICB9KQogICAgICAgIHNhdmVCb29rbWFyayh0aGlzLmZpbGVOYW1lLCB0aGlzLmJvb2ttYXJrKQogICAgICB9KQogICAgfSwKICAgIHJlbW92ZUJvb2ttYXJrICgpIHsKICAgICAgY29uc3QgY3VycmVudExvY2F0aW9uID0gdGhpcy5jdXJyZW50Qm9vay5yZW5kaXRpb24uY3VycmVudExvY2F0aW9uKCkKICAgICAgY29uc3QgY2ZpID0gY3VycmVudExvY2F0aW9uLnN0YXJ0LmNmaQogICAgICB0aGlzLmJvb2ttYXJrID0gZ2V0Qm9va21hcmsodGhpcy5maWxlTmFtZSkKICAgICAgaWYgKHRoaXMuYm9va21hcmspIHsKICAgICAgICB0aGlzLmJvb2ttYXJrID0gdGhpcy5ib29rbWFyay5maWx0ZXIoaXRlbSA9PiBpdGVtLmNmaSAhPT0gY2ZpKQogICAgICAgIHNhdmVCb29rbWFyayh0aGlzLmZpbGVOYW1lLCB0aGlzLmJvb2ttYXJrKQogICAgICAgIHRoaXMuc2V0SXNCb29rbWFyayhmYWxzZSkKICAgICAgfQogICAgfQogIH0sCiAgd2F0Y2g6IHsKICAgIG9mZnNldFkgKHYpIHsKICAgICAgaWYgKCF0aGlzLmJvb2tBdmFpbGFibGUgfHwgdGhpcy5tZW51VmlzaWJsZSB8fCB0aGlzLnNldHRpbmdWaXNpYmxlID49IDApIHsKICAgICAgICByZXR1cm4KICAgICAgfQogICAgICBpZiAodiA+PSB0aGlzLmhlaWdodCAmJiB2IDwgdGhpcy50aHJlc2hvbGQpIHsKICAgICAgICB0aGlzLmJlZm9yZVRocmVzaG9sZCh2KQogICAgICB9IGVsc2UgaWYgKHYgPj0gdGhpcy50aHJlc2hvbGQpIHsKICAgICAgICB0aGlzLmFmdGVyVGhyZXNob2xkKHYpCiAgICAgIH0gZWxzZSBpZiAodiA+IDAgJiYgdiA8IHRoaXMuaGVpZ2h0KSB7CiAgICAgICAgdGhpcy5iZWZvcmVIZWlnaHQoKQogICAgICB9IGVsc2UgaWYgKHYgPT09IDApIHsKICAgICAgICB0aGlzLnJlc3RvcmUoKQogICAgICB9CiAgICB9LAogICAgaXNCb29rbWFyayAoaXNCb29rbWFyaykgewogICAgICBpZiAoaXNCb29rbWFyaykgewogICAgICAgIHRoaXMuY29sb3IgPSBCTFVFCiAgICAgICAgdGhpcy5pc0ZpeGVkID0gdHJ1ZQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuY29sb3IgPSBXSElURQogICAgICAgIHRoaXMuaXNGaXhlZCA9IGZhbHNlCiAgICAgIH0KICAgIH0KICB9Cn0K"},{"version":3,"sources":["EbookBookMark.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;AAeA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"EbookBookMark.vue","sourceRoot":"src/components/ebook","sourcesContent":["<template>\n  <div class=\"ebook-bookmark\" ref=\"bookmark\">\n    <div class=\"ebook-bookmark-text-wrapper\">\n      <div class=\"ebook-bookmark-down-wrapper\" ref=\"icondown\">\n        <span class=\"icon-down\"></span>\n      </div>\n      <div class=\"ebook-bookmark-text\">{{ text }}</div>\n    </div>\n    <div class=\"ebook-bookmark-icon-wrapper\" :style=\"isFixed ? FixedStyle : {}\">\n      <Bookmark :color=\"color\" :width=\"15\" :height=\"35\"></Bookmark>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { realPx } from '../../utils/utils.js'\nimport { ebookMinx } from '../../utils/mixin.js'\nimport Bookmark from '../common/Bookmark.vue'\nimport { getBookmark, saveBookmark } from '../../utils/localstorage.js'\n\nconst BLUE = '#346cbc'\nconst WHITE = '#ffffff'\nexport default {\n  mixins: [ebookMinx],\n  components: {\n    Bookmark\n  },\n  data () {\n    return {\n      text: '',\n      color: WHITE,\n      isFixed: false\n    }\n  },\n  computed: {\n    height () {\n      return realPx(35)\n    },\n    threshold () {\n      return realPx(55)\n    },\n    FixedStyle () {\n      return {\n        position: 'fixed',\n        top: '0',\n        right: `${(window.innerWidth - this.$refs.bookmark.clientWidth) / 2}`\n      }\n    }\n  },\n  methods: {\n    beforeHeight (v) {\n      // stateOne\n      if (this.isBookmark) {\n        this.text = this.$t('book.pulldownDeleteMark')\n        this.color = BLUE\n        this.isFixed = true\n      } else {\n        this.text = this.$t('book.pulldownAddMark')\n        this.color = WHITE\n        this.isFixed = false\n      }\n    },\n    beforeThreshold (v) {\n      // stateTwo\n      this.$refs.bookmark.style.top = `${-v}px`\n      if (this.isBookmark) {\n        this.text = this.$t('book.pulldownDeleteMark')\n        this.color = BLUE\n      } else {\n        this.text = this.$t('book.pulldownAddMark')\n        this.color = WHITE\n      }\n\n      const iconDown = this.$refs.icondown\n      if (iconDown.style.transform === 'rotate(180deg)') {\n        iconDown.style.transform = 'rotate(0deg)'\n      }\n    },\n    afterThreshold (v) {\n      // stateThree\n      this.$refs.bookmark.style.top = `${-v}px`\n      if (this.isBookmark) {\n        this.text = this.$t('book.releaseDeleteMark')\n        this.isFixed = false\n        this.color = WHITE\n      } else {\n        this.text = this.$t('book.releaseAddMark')\n        this.isFixed = true\n        this.color = BLUE\n      }\n      const iconDown = this.$refs.icondown\n      if (\n        iconDown.style.transform === '' ||\n        iconDown.style.transform === 'rotate(0deg)'\n      ) {\n        iconDown.style.transform = 'rotate(180deg)'\n      }\n    },\n    restore () {\n      // stateFour\n      setTimeout(() => {\n        this.$refs.bookmark.style.top = '$ { -this.height }px'\n        this.$refs.icondown.style.transform = 'rotate(0deg)'\n      }, 200)\n      if (this.isFixed) {\n        this.setIsBookmark(true)\n        this.addBookmark()\n      } else {\n        this.setIsBookmark(false)\n        this.removeBookmark()\n      }\n    },\n    addBookmark () {\n      this.bookmark = getBookmark(this.fileName)\n      if (!this.bookmark) {\n        this.bookmark = []\n      }\n      const currentLocation = this.currentBook.rendition.currentLocation()\n      const cfiBase = currentLocation.start.cfi.replace(/!.*/, '')\n      const cfiStart = currentLocation.start.cfi\n        .replace(/.*!/, '')\n        .replace(/\\)$/, '')\n      const cfiEnd = currentLocation.end.cfi\n        .replace(/.*!/, '')\n        .replace(/\\)$/, '')\n      const cfiRange = `${cfiBase}!,${cfiStart},${cfiEnd})`\n      this.currentBook.getRange(cfiRange).then(range => {\n        const text = range.toString().replace(/\\s\\s/g, '')\n        this.bookmark.push({\n          cfi: currentLocation.start.cfi,\n          text: text\n        })\n        saveBookmark(this.fileName, this.bookmark)\n      })\n    },\n    removeBookmark () {\n      const currentLocation = this.currentBook.rendition.currentLocation()\n      const cfi = currentLocation.start.cfi\n      this.bookmark = getBookmark(this.fileName)\n      if (this.bookmark) {\n        this.bookmark = this.bookmark.filter(item => item.cfi !== cfi)\n        saveBookmark(this.fileName, this.bookmark)\n        this.setIsBookmark(false)\n      }\n    }\n  },\n  watch: {\n    offsetY (v) {\n      if (!this.bookAvailable || this.menuVisible || this.settingVisible >= 0) {\n        return\n      }\n      if (v >= this.height && v < this.threshold) {\n        this.beforeThreshold(v)\n      } else if (v >= this.threshold) {\n        this.afterThreshold(v)\n      } else if (v > 0 && v < this.height) {\n        this.beforeHeight()\n      } else if (v === 0) {\n        this.restore()\n      }\n    },\n    isBookmark (isBookmark) {\n      if (isBookmark) {\n        this.color = BLUE\n        this.isFixed = true\n      } else {\n        this.color = WHITE\n        this.isFixed = false\n      }\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n@import \"../../assets/styles/global.scss\";\n\n.ebook-bookmark {\n  position: absolute;\n  top: px2rem(-35);\n  left: 0;\n  width: 100%;\n  height: px2rem(35);\n  z-index: 200;\n\n  .ebook-bookmark-text-wrapper {\n    position: absolute;\n    right: px2rem(45);\n    bottom: 0;\n    display: flex;\n\n    .ebook-bookmark-down-wrapper {\n      font-size: px2rem(14);\n      color: white;\n      transition: all 0.2s linear;\n      @include center;\n    }\n\n    .ebook-bookmark-text {\n      font-size: px2rem(14);\n      color: white;\n    }\n  }\n\n  .ebook-bookmark-icon-wrapper {\n    position: absolute;\n    right: 0;\n    bottom: 0;\n    margin-right: px2rem(15);\n  }\n}\n</style>\n"]}]}