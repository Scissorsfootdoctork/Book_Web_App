{"remainingRequest":"/Users/kscissorfootdoctor/Desktop/Book_Web_App/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/kscissorfootdoctor/Desktop/Book_Web_App/src/components/ebook/EbookBookmark.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/kscissorfootdoctor/Desktop/Book_Web_App/src/components/ebook/EbookBookmark.vue","mtime":1541580605000},{"path":"/Users/kscissorfootdoctor/Desktop/Book_Web_App/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/kscissorfootdoctor/Desktop/Book_Web_App/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/kscissorfootdoctor/Desktop/Book_Web_App/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/kscissorfootdoctor/Desktop/Book_Web_App/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport BookMark from '@/components/ebook/Bookmark'\nimport { realPx } from '@/utils/utils'\nimport { ebookMixin } from '../../utils/mixin'\nimport { saveBookmark, getBookmark } from '../../utils/localStorage'\n\nconst BLUE = '#346cbc'\nconst WHITE = '#fff'\nexport default {\n  mixins: [ebookMixin],\n  components: {\n    BookMark\n  },\n  computed: {\n    height() {\n      return realPx(35)\n    },\n    threshold() {\n      return realPx(55)\n    },\n    fixedStyle() {\n      return {\n        position: 'fixed',\n        right: `${(window.innerWidth - this.$refs.ebookBookmark.clientWidth) / 2}px`,\n        top: 0\n      }\n    }\n  },\n  watch: {\n    offsetY(v) {\n      if (this.settingVisible > 0 || this.menuVisible || this.isPaginating) {\n        return\n      }\n      if (v >= this.height && v < this.threshold) {\n        this.setBookmark = false\n        this.$refs.ebookBookmark.style.top = `${-v}px`\n        if (this.$refs.iconDown.style.transform === 'rotate(180deg)') {\n          this.$refs.iconDown.style.transform = 'rotate(0deg)'\n        }\n        if (!this.isBookmark) {\n          this.text = this.$t('book.pulldownAddMark')\n          this.color = WHITE\n        } else {\n          this.text = this.$t('book.pulldownDeleteMark')\n          this.color = BLUE\n        }\n      } else if (v >= this.threshold) {\n        this.setBookmark = true\n        this.$refs.ebookBookmark.style.top = `${-v}px`\n        if (this.$refs.iconDown.style.transform === 'rotate(0deg)' ||\n          this.$refs.iconDown.style.transform === '') {\n          this.$refs.iconDown.style.transform = 'rotate(180deg)'\n        }\n        if (!this.isBookmark) {\n          this.text = this.$t('book.releaseAddMark')\n          this.color = BLUE\n        } else {\n          this.text = this.$t('book.releaseDeleteMark')\n          this.color = WHITE\n        }\n      } else if (v > 0 && v < this.height) {\n        this.setBookmark = false\n        if (!this.isBookmark) {\n          this.text = this.$t('book.pulldownAddMark')\n        } else {\n          this.text = this.$t('book.pulldownDeleteMark')\n        }\n      } else if (v === 0) {\n        if (!this.isBookmark) {\n          if (this.setBookmark) {\n            this.fixed = true\n            this.setAndSaveBookmark()\n          } else {\n            this.fixed = false\n          }\n        } else {\n          if (this.setBookmark) {\n            this.fixed = false\n            this.removeBookmark()\n          } else {\n            this.fixed = true\n          }\n        }\n        setTimeout(() => {\n          this.$refs.ebookBookmark.style.top = `${-this.height}px`\n          this.$refs.iconDown.style.transform = 'rotate(0deg)'\n          if (!this.fixed && this.color === BLUE) {\n            this.color = WHITE\n          }\n          if (this.text === this.$t('book.releaseAddMark')) {\n            this.text = this.$t('book.pulldownAddMark')\n          }\n          this.setBookmark = false\n        }, 200)\n      }\n    },\n    isBookmark(v) {\n      this.fixed = v\n      if (v) {\n        this.color = BLUE\n      } else {\n        this.color = WHITE\n      }\n    }\n  },\n  data() {\n    return {\n      color: WHITE,\n      text: '',\n      setBookmark: false,\n      fixed: false\n    }\n  },\n  methods: {\n    setAndSaveBookmark() {\n      this.bookmark = getBookmark(this.fileName)\n      if (!this.bookmark) {\n        this.bookmark = []\n      }\n      const currentLocation = this.currentBook.rendition.currentLocation()\n      const cfibase = currentLocation.start.cfi.replace(/!.*/, '').replace('epubcfi(', '')\n      const cfistart = currentLocation.start.cfi.replace(/.*!/, '').replace(/\\)/, '')\n      const cfiend = currentLocation.end.cfi.replace(/.*!/, '').replace(/\\)/, '')\n      const cfiRange = `epubcfi(${cfibase}!,${cfistart},${cfiend})`\n      const cfi = currentLocation.start.cfi\n      this.currentBook.getRange(cfiRange).then(range => {\n        let text = range.toString()\n        text = text.replace(/\\s\\s/g, '')\n        text = text.replace(/\\r/g, '')\n        text = text.replace(/\\n/g, '')\n        text = text.replace(/\\t/g, '')\n        text = text.replace(/\\f/g, '')\n        this.bookmark.push({\n          cfi: cfi,\n          text: text\n        })\n        this.setIsBookmark(true)\n        saveBookmark(this.fileName, this.bookmark)\n      })\n    },\n    removeBookmark() {\n      const currentLocation = this.currentBook.rendition.currentLocation()\n      const cfi = currentLocation.start.cfi\n      if (this.bookmark) {\n        this.bookmark = this.bookmark.filter(item => item.cfi !== cfi)\n        saveBookmark(this.fileName, this.bookmark)\n      }\n      this.setIsBookmark(false)\n    }\n  }\n}\n",{"version":3,"sources":["EbookBookmark.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AAiBA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"EbookBookmark.vue","sourceRoot":"src/components/ebook","sourcesContent":["<template>\n  <div class=\"ebook-bookmark\" ref=\"ebookBookmark\">\n    <div class=\"ebook-bookmark-text-wrapper\">\n      <div class=\"ebook-bookmark-down-wrapper\" ref=\"iconDown\">\n        <span class=\"icon-down\"></span>\n      </div>\n      <div class=\"ebook-bookmark-text\">\n        {{text}}\n      </div>\n    </div>\n    <div class=\"ebook-bookmark-icon-wrapper\" :style=\"fixed && !isPaginating ? fixedStyle : {}\">\n      <book-mark :width=\"15\" :height=\"35\" :color=\"color\" ref=\"bookmark\"></book-mark>\n    </div>\n  </div>\n</template>\n\n<script type=\"text/ecmascript-6\">\n  import BookMark from '@/components/ebook/Bookmark'\n  import { realPx } from '@/utils/utils'\n  import { ebookMixin } from '../../utils/mixin'\n  import { saveBookmark, getBookmark } from '../../utils/localStorage'\n\n  const BLUE = '#346cbc'\n  const WHITE = '#fff'\n  export default {\n    mixins: [ebookMixin],\n    components: {\n      BookMark\n    },\n    computed: {\n      height() {\n        return realPx(35)\n      },\n      threshold() {\n        return realPx(55)\n      },\n      fixedStyle() {\n        return {\n          position: 'fixed',\n          right: `${(window.innerWidth - this.$refs.ebookBookmark.clientWidth) / 2}px`,\n          top: 0\n        }\n      }\n    },\n    watch: {\n      offsetY(v) {\n        if (this.settingVisible > 0 || this.menuVisible || this.isPaginating) {\n          return\n        }\n        if (v >= this.height && v < this.threshold) {\n          this.setBookmark = false\n          this.$refs.ebookBookmark.style.top = `${-v}px`\n          if (this.$refs.iconDown.style.transform === 'rotate(180deg)') {\n            this.$refs.iconDown.style.transform = 'rotate(0deg)'\n          }\n          if (!this.isBookmark) {\n            this.text = this.$t('book.pulldownAddMark')\n            this.color = WHITE\n          } else {\n            this.text = this.$t('book.pulldownDeleteMark')\n            this.color = BLUE\n          }\n        } else if (v >= this.threshold) {\n          this.setBookmark = true\n          this.$refs.ebookBookmark.style.top = `${-v}px`\n          if (this.$refs.iconDown.style.transform === 'rotate(0deg)' ||\n            this.$refs.iconDown.style.transform === '') {\n            this.$refs.iconDown.style.transform = 'rotate(180deg)'\n          }\n          if (!this.isBookmark) {\n            this.text = this.$t('book.releaseAddMark')\n            this.color = BLUE\n          } else {\n            this.text = this.$t('book.releaseDeleteMark')\n            this.color = WHITE\n          }\n        } else if (v > 0 && v < this.height) {\n          this.setBookmark = false\n          if (!this.isBookmark) {\n            this.text = this.$t('book.pulldownAddMark')\n          } else {\n            this.text = this.$t('book.pulldownDeleteMark')\n          }\n        } else if (v === 0) {\n          if (!this.isBookmark) {\n            if (this.setBookmark) {\n              this.fixed = true\n              this.setAndSaveBookmark()\n            } else {\n              this.fixed = false\n            }\n          } else {\n            if (this.setBookmark) {\n              this.fixed = false\n              this.removeBookmark()\n            } else {\n              this.fixed = true\n            }\n          }\n          setTimeout(() => {\n            this.$refs.ebookBookmark.style.top = `${-this.height}px`\n            this.$refs.iconDown.style.transform = 'rotate(0deg)'\n            if (!this.fixed && this.color === BLUE) {\n              this.color = WHITE\n            }\n            if (this.text === this.$t('book.releaseAddMark')) {\n              this.text = this.$t('book.pulldownAddMark')\n            }\n            this.setBookmark = false\n          }, 200)\n        }\n      },\n      isBookmark(v) {\n        this.fixed = v\n        if (v) {\n          this.color = BLUE\n        } else {\n          this.color = WHITE\n        }\n      }\n    },\n    data() {\n      return {\n        color: WHITE,\n        text: '',\n        setBookmark: false,\n        fixed: false\n      }\n    },\n    methods: {\n      setAndSaveBookmark() {\n        this.bookmark = getBookmark(this.fileName)\n        if (!this.bookmark) {\n          this.bookmark = []\n        }\n        const currentLocation = this.currentBook.rendition.currentLocation()\n        const cfibase = currentLocation.start.cfi.replace(/!.*/, '').replace('epubcfi(', '')\n        const cfistart = currentLocation.start.cfi.replace(/.*!/, '').replace(/\\)/, '')\n        const cfiend = currentLocation.end.cfi.replace(/.*!/, '').replace(/\\)/, '')\n        const cfiRange = `epubcfi(${cfibase}!,${cfistart},${cfiend})`\n        const cfi = currentLocation.start.cfi\n        this.currentBook.getRange(cfiRange).then(range => {\n          let text = range.toString()\n          text = text.replace(/\\s\\s/g, '')\n          text = text.replace(/\\r/g, '')\n          text = text.replace(/\\n/g, '')\n          text = text.replace(/\\t/g, '')\n          text = text.replace(/\\f/g, '')\n          this.bookmark.push({\n            cfi: cfi,\n            text: text\n          })\n          this.setIsBookmark(true)\n          saveBookmark(this.fileName, this.bookmark)\n        })\n      },\n      removeBookmark() {\n        const currentLocation = this.currentBook.rendition.currentLocation()\n        const cfi = currentLocation.start.cfi\n        if (this.bookmark) {\n          this.bookmark = this.bookmark.filter(item => item.cfi !== cfi)\n          saveBookmark(this.fileName, this.bookmark)\n        }\n        this.setIsBookmark(false)\n      }\n    }\n  }\n</script>\n\n<style lang=\"scss\" rel=\"stylesheet/scss\" scoped>\n  @import \"../../assets/styles/global\";\n\n  .ebook-bookmark {\n    position: absolute;\n    top: px2rem(-35);\n    left: 0;\n    z-index: 200;\n    width: 100%;\n    height: px2rem(35);\n    .ebook-bookmark-text-wrapper {\n      position: absolute;\n      right: px2rem(45);\n      bottom: 0;\n      display: flex;\n      .ebook-bookmark-down-wrapper {\n        font-size: px2rem(14);\n        color: white;\n        transition: all .2s linear;\n        @include center;\n      }\n      .ebook-bookmark-text {\n        font-size: px2rem(14);\n        color: white;\n      }\n    }\n    .ebook-bookmark-icon-wrapper {\n      position: absolute;\n      right: 0;\n      bottom: 0;\n      margin-right: px2rem(10);\n    }\n  }\n</style>\n"]}]}