{"remainingRequest":"/Users/kscissorfootdoctor/Desktop/Book_Web_App/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/kscissorfootdoctor/Desktop/Book_Web_App/src/components/ebook/EbookReder.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/kscissorfootdoctor/Desktop/Book_Web_App/src/components/ebook/EbookReder.vue","mtime":1583689560723},{"path":"/Users/kscissorfootdoctor/Desktop/Book_Web_App/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/kscissorfootdoctor/Desktop/Book_Web_App/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/kscissorfootdoctor/Desktop/Book_Web_App/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/kscissorfootdoctor/Desktop/Book_Web_App/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IGVib29rTWlueCB9IGZyb20gIi4uLy4uL3V0aWxzL21peGluIjsKaW1wb3J0IHsKICBnZXRGb250RmFtaWx5LAogIHNhdmVGb250RmFtaWx5LAogIGdldEZvbnRTaXplLAogIHNhdmVGb250U2l6ZSwKICBnZXRUaGVtZSwKICBzYXZlVGhlbWUKfSBmcm9tICIuLi8uLi91dGlscy9sb2NhbHN0b3JhZ2UuanMiOwppbXBvcnQgRXB1YiBmcm9tICJlcHVianMiOwpnbG9iYWwuZXB1YiA9IEVwdWI7CmV4cG9ydCBkZWZhdWx0IHsKICBtaXhpbnM6IFtlYm9va01pbnhdLAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICB0b3VjaFN0YXJ0OiAiIiwKICAgICAgdG91Y2hUaW1lOiAiIgogICAgfTsKICB9LAogIG1ldGhvZHM6IHsKICAgIHByZXZQYWdlKCkgewogICAgICBpZiAodGhpcy5yZW5kaXRpb24pIHsKICAgICAgICB0aGlzLnJlbmRpdGlvbi5wcmV2KCk7CiAgICAgICAgdGhpcy5oaWRlVGl0bGVBbmRNZW51KCk7CiAgICAgIH0KICAgIH0sCiAgICBuZXh0UGFnZSgpIHsKICAgICAgaWYgKHRoaXMucmVuZGl0aW9uKSB7CiAgICAgICAgdGhpcy5yZW5kaXRpb24ubmV4dCgpOwogICAgICAgIHRoaXMuaGlkZVRpdGxlQW5kTWVudSgpOwogICAgICB9CiAgICB9LAogICAgc2hvd1RpdGxlQW5kTWVudSgpIHsKICAgICAgaWYgKHRoaXMubWVudVZpc2libGUpIHsKICAgICAgICB0aGlzLnNldFNldHRpbmdWaXNpYmxlKC0xKTsKICAgICAgICB0aGlzLnNldEZvbnRGYW1pbHlWaXNpYmxlKGZhbHNlKTsKICAgICAgfQogICAgICB0aGlzLnNldE1lbnVWaXNpYmxlKCF0aGlzLm1lbnVWaXNpYmxlKTsKICAgIH0sCiAgICBoaWRlVGl0bGVBbmRNZW51KCkgewogICAgICB0aGlzLnNldE1lbnVWaXNpYmxlKGZhbHNlKTsKICAgICAgdGhpcy5zZXRGb250RmFtaWx5VmlzaWJsZShmYWxzZSk7CiAgICAgIHRoaXMuc2V0U2V0dGluZ1Zpc2libGUoLTEpOwogICAgfSwKICAgIGluaXRGb250U2l6ZSgpIHsKICAgICAgY29uc3QgZm9udFNpemUgPSBnZXRGb250U2l6ZSh0aGlzLmZpbGVOYW1lKTsKICAgICAgaWYgKCFmb250U2l6ZSkgewogICAgICAgIHNhdmVGb250U2l6ZSh0aGlzLmZpbGVOYW1lLCB0aGlzLmRlZnVsdEZvbnRTaXplKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmN1cnJlbnRCb29rLnJlbmRpdGlvbi50aGVtZXMuZm9udFNpemUoZm9udFNpemUpOwogICAgICAgIHRoaXMuc2V0RGVmYXVsdEZvbnRTaXplKGZvbnRTaXplKTsKICAgICAgfQogICAgfSwKICAgIGluaXRGb250RmFtaWx5KCkgewogICAgICBjb25zdCBmb250ID0gZ2V0Rm9udEZhbWlseSh0aGlzLmZpbGVOYW1lKTsKICAgICAgaWYgKCFmb250KSB7CiAgICAgICAgc2F2ZUZvbnRGYW1pbHkodGhpcy5maWxlTmFtZSwgdGhpcy5kZWZhdWx0Rm9udEZhbWlseSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5jdXJyZW50Qm9vay5yZW5kaXRpb24udGhlbWVzLmZvbnQoZm9udCk7CiAgICAgICAgdGhpcy5zZXREZWZhdWx0Rm9udEZhbWlseShmb250KTsKICAgICAgfQogICAgfSwKICAgIGluaXRUaGVtZSgpIHsKICAgICAgbGV0IGRlZmF1bHRUaGVtZSA9IGdldFRoZW1lKHRoaXMuZmlsZU5hbWUpOwogICAgICBpZiAoIWRlZmF1bHRUaGVtZSkgewogICAgICAgIGRlZmF1bHRUaGVtZSA9IHRoaXMuVGhlbWVMaXN0WzBdLm5hbWU7CiAgICAgICAgc2F2ZVRoZW1lKHRoaXMuZmlsZU5hbWUsIGRlZmF1bHRUaGVtZSk7CiAgICAgIH0KICAgICAgdGhpcy5zZXREZWZhdWx0VGhlbWUoZGVmYXVsdFRoZW1lKTsKICAgICAgdGhpcy5UaGVtZUxpc3QuZm9yRWFjaChlbGVtZW50ID0+IHsKICAgICAgICB0aGlzLnJlbmRpdGlvbi50aGVtZXMucmVnaXN0ZXIoZWxlbWVudC5uYW1lLCBlbGVtZW50LnN0eWxlKTsKICAgICAgfSk7CiAgICAgIHRoaXMucmVuZGl0aW9uLnRoZW1lcy5zZWxlY3QoZGVmYXVsdFRoZW1lKTsKICAgIH0sCiAgICBpbml0UmVuZGl0aW9uKCkgewogICAgICB0aGlzLnJlbmRpdGlvbiA9IHRoaXMuYm9vay5yZW5kZXJUbygicmVhZCIsIHsKICAgICAgICB3aWR0aDogaW5uZXJXaWR0aCwKICAgICAgICBoZWlnaHQ6IGlubmVySGVpZ2h0LAogICAgICAgIG1ldGhvZDogImRlZmF1bHQiCiAgICAgIH0pOwoKICAgICAgdGhpcy5yZW5kaXRpb24uZGlzcGxheSgpLnRoZW4oKCkgPT4gewogICAgICAgIHRoaXMuaW5pdFRoZW1lKCk7CiAgICAgICAgdGhpcy5pbml0Rm9udFNpemUoKTsKICAgICAgICB0aGlzLmluaXRGb250RmFtaWx5KCk7CiAgICAgICAgdGhpcy5pbml0R2xvYmxlU3R5bGUoKTsKICAgICAgfSk7CiAgICAgIHRoaXMucmVuZGl0aW9uLmhvb2tzLmNvbnRlbnQucmVnaXN0ZXIoY29udGVudHMgPT4gewogICAgICAgIFByb21pc2UuYWxsKFsKICAgICAgICAgIGNvbnRlbnRzLmFkZFN0eWxlc2hlZXQoCiAgICAgICAgICAgIGAke3Byb2Nlc3MuZW52LlZVRV9BUFBfUkVTX1VSTH0vZm9udHMvZGF5c09uZS5jc3NgCiAgICAgICAgICApLAogICAgICAgICAgY29udGVudHMuYWRkU3R5bGVzaGVldCgKICAgICAgICAgICAgYCR7cHJvY2Vzcy5lbnYuVlVFX0FQUF9SRVNfVVJMfS9mb250cy9jYWJpbi5jc3NgCiAgICAgICAgICApLAogICAgICAgICAgY29udGVudHMuYWRkU3R5bGVzaGVldCgKICAgICAgICAgICAgYCR7cHJvY2Vzcy5lbnYuVlVFX0FQUF9SRVNfVVJMfS9mb250cy9tb250c2VycmF0LmNzc2AKICAgICAgICAgICksCiAgICAgICAgICBjb250ZW50cy5hZGRTdHlsZXNoZWV0KAogICAgICAgICAgICBgJHtwcm9jZXNzLmVudi5WVUVfQVBQX1JFU19VUkx9L2ZvbnRzL3RhbmdlcmluZS5jc3NgCiAgICAgICAgICApCiAgICAgICAgXSkudGhlbigoKSA9PiB7CiAgICAgICAgICBjb25zb2xlLmxvZygi5a2X5L2T5YWo6YOo5Yqg6L295a6M5q+VLi4uIik7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSwKICAgIGluaXRHZXN0dXJlKCkgewogICAgICB0aGlzLnJlbmRpdGlvbi5vbigidG91Y2hzdGFydCIsIGUgPT4gewogICAgICAgIHRoaXMudG91Y2hTdGFydCA9IGUuY2hhbmdlZFRvdWNoZXNbMF0uY2xpZW50WDsKICAgICAgICB0aGlzLnRvdWNoVGltZSA9IGUudGltZVN0YW1wOwogICAgICB9KTsKICAgICAgdGhpcy5yZW5kaXRpb24ub24oInRvdWNoZW5kIiwgZSA9PiB7CiAgICAgICAgY29uc3Qgb2Zmc2V0WCA9IHRoaXMudG91Y2hTdGFydCAtIGUuY2hhbmdlZFRvdWNoZXNbMF0uY2xpZW50WDsKICAgICAgICBjb25zdCBUaW1lID0gZS50aW1lU3RhbXAgLSB0aGlzLnRvdWNoVGltZTsKICAgICAgICBpZiAoVGltZSA8IDQwMCAmJiBvZmZzZXRYID4gNDApIHsKICAgICAgICAgIHRoaXMubmV4dFBhZ2UoKTsKICAgICAgICB9IGVsc2UgaWYgKFRpbWUgPCA0MDAgJiYgb2Zmc2V0WCA8IC00MCkgewogICAgICAgICAgdGhpcy5wcmV2UGFnZSgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnNob3dUaXRsZUFuZE1lbnUoKTsKICAgICAgICB9CiAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgfSk7CiAgICB9LAogICAgaW5pdEVwdWIoKSB7CiAgICAgIGNvbnN0IFVybCA9CiAgICAgICAgYCR7cHJvY2Vzcy5lbnYuVlVFX0FQUF9SRVNfVVJMfS9lcHViL2AgKyB0aGlzLmZpbGVOYW1lICsgIi5lcHViIjsKICAgICAgdGhpcy5ib29rID0gbmV3IEVwdWIoVXJsKTsKICAgICAgdGhpcy5zZXRDdXJyZW50Qm9vayh0aGlzLmJvb2spOwogICAgICB0aGlzLmluaXRSZW5kaXRpb24oKTsKICAgICAgdGhpcy5pbml0R2VzdHVyZSgpCiAgICAgIHRoaXMuYm9vay5yZWFkeS50aGVuKCgpID0+IHsKICAgICAgICByZXR1cm4gdGhpcy5ib29rLmxvY2F0aW9ucy5nZW5lcmF0ZSg3NTAgKiAod2luZG93LmlubmVyV2lkdGggLyAzNzUpICogKGdldEZvbnRTaXplKHRoaXMuZmlsZU5hbWUpIC8gMTYpKQogICAgICB9KS50aGVuKChsb2NhdGlvbnMpID0+IHsKICAgICAgICB0aGlzLnNldEJvb2tBdmFpbGFibGUodHJ1ZSkKICAgICAgfSkKICAgIH0KICB9LAoKICBtb3VudGVkKCkgewogICAgdGhpcy5zZXRGaWxlTmFtZSh0aGlzLiRyb3V0ZS5wYXJhbXMuZmlsZU5hbWUuc3BsaXQoInwiKS5qb2luKCIvIikpLnRoZW4oCiAgICAgICgpID0+IHsKICAgICAgICB0aGlzLmluaXRFcHViKCk7CiAgICAgIH0KICAgICk7CiAgfQp9Owo="},{"version":3,"sources":["EbookReder.vue"],"names":[],"mappings":";;;;;;;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"EbookReder.vue","sourceRoot":"src/components/ebook","sourcesContent":["<template>\n  <div class=\"Ebook-Reder\">\n    <div id=\"read\"></div>\n  </div>\n</template>\n\n<script>\nimport { ebookMinx } from \"../../utils/mixin\";\nimport {\n  getFontFamily,\n  saveFontFamily,\n  getFontSize,\n  saveFontSize,\n  getTheme,\n  saveTheme\n} from \"../../utils/localstorage.js\";\nimport Epub from \"epubjs\";\nglobal.epub = Epub;\nexport default {\n  mixins: [ebookMinx],\n  data() {\n    return {\n      touchStart: \"\",\n      touchTime: \"\"\n    };\n  },\n  methods: {\n    prevPage() {\n      if (this.rendition) {\n        this.rendition.prev();\n        this.hideTitleAndMenu();\n      }\n    },\n    nextPage() {\n      if (this.rendition) {\n        this.rendition.next();\n        this.hideTitleAndMenu();\n      }\n    },\n    showTitleAndMenu() {\n      if (this.menuVisible) {\n        this.setSettingVisible(-1);\n        this.setFontFamilyVisible(false);\n      }\n      this.setMenuVisible(!this.menuVisible);\n    },\n    hideTitleAndMenu() {\n      this.setMenuVisible(false);\n      this.setFontFamilyVisible(false);\n      this.setSettingVisible(-1);\n    },\n    initFontSize() {\n      const fontSize = getFontSize(this.fileName);\n      if (!fontSize) {\n        saveFontSize(this.fileName, this.defultFontSize);\n      } else {\n        this.currentBook.rendition.themes.fontSize(fontSize);\n        this.setDefaultFontSize(fontSize);\n      }\n    },\n    initFontFamily() {\n      const font = getFontFamily(this.fileName);\n      if (!font) {\n        saveFontFamily(this.fileName, this.defaultFontFamily);\n      } else {\n        this.currentBook.rendition.themes.font(font);\n        this.setDefaultFontFamily(font);\n      }\n    },\n    initTheme() {\n      let defaultTheme = getTheme(this.fileName);\n      if (!defaultTheme) {\n        defaultTheme = this.ThemeList[0].name;\n        saveTheme(this.fileName, defaultTheme);\n      }\n      this.setDefaultTheme(defaultTheme);\n      this.ThemeList.forEach(element => {\n        this.rendition.themes.register(element.name, element.style);\n      });\n      this.rendition.themes.select(defaultTheme);\n    },\n    initRendition() {\n      this.rendition = this.book.renderTo(\"read\", {\n        width: innerWidth,\n        height: innerHeight,\n        method: \"default\"\n      });\n\n      this.rendition.display().then(() => {\n        this.initTheme();\n        this.initFontSize();\n        this.initFontFamily();\n        this.initGlobleStyle();\n      });\n      this.rendition.hooks.content.register(contents => {\n        Promise.all([\n          contents.addStylesheet(\n            `${process.env.VUE_APP_RES_URL}/fonts/daysOne.css`\n          ),\n          contents.addStylesheet(\n            `${process.env.VUE_APP_RES_URL}/fonts/cabin.css`\n          ),\n          contents.addStylesheet(\n            `${process.env.VUE_APP_RES_URL}/fonts/montserrat.css`\n          ),\n          contents.addStylesheet(\n            `${process.env.VUE_APP_RES_URL}/fonts/tangerine.css`\n          )\n        ]).then(() => {\n          console.log(\"字体全部加载完毕...\");\n        });\n      });\n    },\n    initGesture() {\n      this.rendition.on(\"touchstart\", e => {\n        this.touchStart = e.changedTouches[0].clientX;\n        this.touchTime = e.timeStamp;\n      });\n      this.rendition.on(\"touchend\", e => {\n        const offsetX = this.touchStart - e.changedTouches[0].clientX;\n        const Time = e.timeStamp - this.touchTime;\n        if (Time < 400 && offsetX > 40) {\n          this.nextPage();\n        } else if (Time < 400 && offsetX < -40) {\n          this.prevPage();\n        } else {\n          this.showTitleAndMenu();\n        }\n         e.preventDefault();\n         e.stopPropagation();\n      });\n    },\n    initEpub() {\n      const Url =\n        `${process.env.VUE_APP_RES_URL}/epub/` + this.fileName + \".epub\";\n      this.book = new Epub(Url);\n      this.setCurrentBook(this.book);\n      this.initRendition();\n      this.initGesture()\n      this.book.ready.then(() => {\n        return this.book.locations.generate(750 * (window.innerWidth / 375) * (getFontSize(this.fileName) / 16))\n      }).then((locations) => {\n        this.setBookAvailable(true)\n      })\n    }\n  },\n\n  mounted() {\n    this.setFileName(this.$route.params.fileName.split(\"|\").join(\"/\")).then(\n      () => {\n        this.initEpub();\n      }\n    );\n  }\n};\n</script>\n\n<style lang=\"scss\" scoped></style>\n"]}]}