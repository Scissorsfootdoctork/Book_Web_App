{"remainingRequest":"/Users/kscissorfootdoctor/Desktop/Book_Web_App/node_modules/babel-loader/lib/index.js!/Users/kscissorfootdoctor/Desktop/Book_Web_App/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/kscissorfootdoctor/Desktop/Book_Web_App/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/kscissorfootdoctor/Desktop/Book_Web_App/src/views/store/bookCategory.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/kscissorfootdoctor/Desktop/Book_Web_App/src/views/store/bookCategory.vue","mtime":1541580605000},{"path":"/Users/kscissorfootdoctor/Desktop/Book_Web_App/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/kscissorfootdoctor/Desktop/Book_Web_App/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/kscissorfootdoctor/Desktop/Book_Web_App/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/kscissorfootdoctor/Desktop/Book_Web_App/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"/Users/kscissorfootdoctor/Desktop/Book_Web_App/node_modules/@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport \"core-js/modules/es6.regexp.replace\";\nimport _toConsumableArray from \"/Users/kscissorfootdoctor/Desktop/Book_Web_App/node_modules/@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.array.for-each\";\nimport \"core-js/modules/es6.array.filter\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport ShelfTitle from '@/components/shelf/shelfTitle';\nimport BookShelf from '@/components/shelf/shelf';\nimport ScrollView from '@/components/Scroll';\nimport BookShelfFooter from '@/components/shelf/bookShelfFooter';\nimport Toast from '@/components/shelf/toast';\nimport { getLocalStorage, setLocalStorage } from '@/utils/localStorage';\nimport { getLocalForage, removeLocalForage } from '@/utils/localForage';\nimport { download } from '@/api/book';\nimport Epub from 'epubjs';\nglobal.ePub = Epub;\nvar BOOK_SHELF_KEY = 'bookShelf';\nexport default {\n  components: {\n    ShelfTitle: ShelfTitle,\n    ScrollView: ScrollView,\n    BookShelf: BookShelf,\n    BookShelfFooter: BookShelfFooter,\n    Toast: Toast\n  },\n  computed: {\n    isEmpty: function isEmpty() {\n      if (this.category && this.category.itemList && this.category.itemList.length > 0) {\n        return false;\n      } else {\n        return true;\n      }\n    }\n  },\n  data: function data() {\n    return {\n      index: null,\n      bookList: [],\n      category: {},\n      isEditMode: false,\n      ifShowBack: true,\n      ifShowClear: false,\n      scrollBottom: 0,\n      toastText: ''\n    };\n  },\n  methods: {\n    editGroupName: function editGroupName(category, groupName) {\n      category.title = groupName;\n      this.onEditClick(false);\n      this.saveBookShelfToLocalStorage();\n    },\n    deleteGroup: function deleteGroup(category) {\n      var itemList = this.getBooksFromCategory(category);\n      this.removeCategory(category);\n      this.clearAddFromBookList();\n      this.appendBookToList(itemList);\n      this.appendAddToBookList();\n      this.onEditClick(false);\n      this.saveBookShelfToLocalStorage();\n      this.$router.go(-1);\n    },\n    removeCategory: function removeCategory(category) {\n      this.bookList = this.bookList.filter(function (item) {\n        return category.id !== item.id;\n      });\n    },\n    getBooksFromCategory: function getBooksFromCategory(category) {\n      return category.itemList;\n    },\n    groupEdit: function groupEdit(operation, group) {\n      switch (operation) {\n        case 1:\n          this.moveToGroup(group);\n          break;\n\n        case 2:\n          this.newGroup(group);\n          this.moveToGroup(group);\n          break;\n\n        case 3:\n          this.moveOutGroup();\n          break;\n      }\n    },\n    getSelectedBooks: function getSelectedBooks() {\n      var selectedBooks = this.bookList.filter(function (item) {\n        return item.selected;\n      });\n      this.bookList.filter(function (item) {\n        if (item.type === 2 && item.itemList) {\n          item.itemList.filter(function (subItem) {\n            if (subItem.selected) {\n              selectedBooks.push(subItem);\n            }\n          });\n        }\n      });\n      return selectedBooks;\n    },\n    clearSelectedBooks: function clearSelectedBooks() {\n      this.bookList = this.bookList.filter(function (item) {\n        return !item.selected;\n      });\n      this.bookList.forEach(function (item) {\n        if (item.type === 2 && item.itemList) {\n          item.itemList = item.itemList.filter(function (subItem) {\n            return !subItem.selected;\n          });\n        }\n      });\n    },\n    appendBookToList: function appendBookToList(selectedBooks) {\n      var _this = this;\n\n      var id = this.bookList[this.bookList.length - 1].id + 1;\n      selectedBooks.forEach(function (item) {\n        item.id = id++;\n\n        _this.bookList.push(item);\n      });\n    },\n    moveOutGroup: function moveOutGroup() {\n      this.clearAddFromBookList();\n      var selectedBooks = this.getSelectedBooks();\n      this.clearSelectedBooks();\n      this.appendBookToList(selectedBooks);\n      this.appendAddToBookList();\n      this.onEditClick(false);\n      this.saveBookShelfToLocalStorage();\n      this.showToast(this.$t('shelf.moveBookOutSuccess'));\n    },\n    newGroup: function newGroup(group) {\n      this.clearAddFromBookList();\n      this.bookList.push(group);\n      this.appendAddToBookList();\n    },\n    moveToGroup: function moveToGroup(group) {\n      var selectedBooks = this.getSelectedBooks();\n      this.clearSelectedBooks();\n\n      if (group && group.itemList) {\n        group.itemList = [].concat(_toConsumableArray(group.itemList), _toConsumableArray(selectedBooks));\n        group.itemList.forEach(function (item, index) {\n          item.id = index + 1;\n        });\n      }\n\n      this.onEditClick(false);\n      this.saveBookShelfToLocalStorage();\n      this.showToast(this.$t('shelf.moveBookInSuccess').replace('$1', group.title));\n    },\n    appendAddToBookList: function appendAddToBookList() {\n      this.bookList.push({\n        cover: '',\n        title: '',\n        type: 3,\n        id: this.bookList[this.bookList.length - 1].id + 1\n      });\n    },\n    clearAddFromBookList: function clearAddFromBookList() {\n      this.bookList = this.bookList.filter(function (item) {\n        return item.type !== 3;\n      });\n    },\n    removeBook: function removeBook() {\n      this.bookList = this.bookList.filter(function (item) {\n        if (item.itemList) {\n          item.itemList = item.itemList.filter(function (subItem) {\n            return !subItem.selected;\n          });\n        }\n\n        return !item.selected;\n      });\n      this.onEditClick(false);\n      this.saveBookShelfToLocalStorage();\n    },\n    onBookClick: function onBookClick(item, index) {\n      this.$router.push({\n        path: '/book-store/detail',\n        query: {\n          fileName: item.fileName,\n          category: item.categoryText\n        }\n      });\n    },\n    showToast: function showToast(text) {\n      this.toastText = text;\n      this.$refs.toast.show();\n    },\n    removeDownloadBook: function removeDownloadBook(item) {\n      return new Promise(function (resolve, reject) {\n        removeLocalForage(item.fileName, function () {\n          console.log(\"[\".concat(item.fileName, \"]\\u5220\\u9664\\u6210\\u529F...\"));\n          resolve();\n        }, reject);\n      });\n    },\n    downloadBook: function downloadBook(item) {\n      return new Promise(function (resolve, reject) {\n        getLocalForage(item.fileName, function (err, value) {\n          if (!err && value instanceof Blob) {\n            console.log(\"[\".concat(item.fileName, \"]\\u8BFB\\u53D6\\u6210\\u529F...\"), value, new Epub(value));\n            resolve();\n          } else {\n            download(item, function (item) {\n              console.log('[' + item.fileName + ']下载成功...');\n              resolve();\n            }, reject, reject);\n          }\n        });\n      });\n    },\n    setDownload: function () {\n      var _setDownload = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(needDownload) {\n        var _this2 = this;\n\n        var _loop, i;\n\n        return regeneratorRuntime.wrap(function _callee$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                if (needDownload) {\n                  this.showToast(this.$t('shelf.setDownloadSuccess'));\n                } else {\n                  this.showToast(this.$t('shelf.removeDownloadSuccess'));\n                }\n\n                _loop = /*#__PURE__*/regeneratorRuntime.mark(function _loop(i) {\n                  var item, _i;\n\n                  return regeneratorRuntime.wrap(function _loop$(_context) {\n                    while (1) {\n                      switch (_context.prev = _context.next) {\n                        case 0:\n                          item = _this2.bookList[i];\n\n                          if (!(needDownload && item.selected)) {\n                            _context.next = 7;\n                            break;\n                          }\n\n                          console.log(\"item-\\u6B63\\u5728\\u5904\\u7406\\u7B2C\".concat(i + 1, \"\\u672C\\u4E66\"));\n                          _context.next = 5;\n                          return _this2.downloadBook(item).then(function () {\n                            item.cache = needDownload;\n                          });\n\n                        case 5:\n                          _context.next = 11;\n                          break;\n\n                        case 7:\n                          if (!(!needDownload && item.selected)) {\n                            _context.next = 11;\n                            break;\n                          }\n\n                          console.log(\"item-\\u6B63\\u5728\\u5904\\u7406\\u7B2C\".concat(i + 1, \"\\u672C\\u4E66\"));\n                          _context.next = 11;\n                          return _this2.removeDownloadBook(item).then(function () {\n                            item.cache = needDownload;\n                          });\n\n                        case 11:\n                          if (!item.itemList) {\n                            _context.next = 19;\n                            break;\n                          }\n\n                          _i = 0;\n\n                        case 13:\n                          if (!(_i < item.itemList.length)) {\n                            _context.next = 19;\n                            break;\n                          }\n\n                          _context.next = 16;\n                          return _this2.downloadItem(item.itemList[_i], needDownload);\n\n                        case 16:\n                          _i++;\n                          _context.next = 13;\n                          break;\n\n                        case 19:\n                        case \"end\":\n                          return _context.stop();\n                      }\n                    }\n                  }, _loop);\n                });\n                i = 0;\n\n              case 3:\n                if (!(i < this.bookList.length)) {\n                  _context2.next = 8;\n                  break;\n                }\n\n                return _context2.delegateYield(_loop(i), \"t0\", 5);\n\n              case 5:\n                i++;\n                _context2.next = 3;\n                break;\n\n              case 8:\n                this.onEditClick(false);\n                this.saveBookShelfToLocalStorage();\n                console.log('数据保存成功...');\n\n              case 11:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function setDownload(_x) {\n        return _setDownload.apply(this, arguments);\n      }\n\n      return setDownload;\n    }(),\n    downloadItem: function () {\n      var _downloadItem = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2(subItem, needDownload) {\n        return regeneratorRuntime.wrap(function _callee2$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                console.log(\"subItem-\\u6B63\\u5728\\u5904\\u7406\".concat(subItem.fileName));\n\n                if (!(needDownload && subItem.selected)) {\n                  _context3.next = 6;\n                  break;\n                }\n\n                _context3.next = 4;\n                return this.downloadBook(subItem).then(function () {\n                  subItem.cache = needDownload;\n                });\n\n              case 4:\n                _context3.next = 9;\n                break;\n\n              case 6:\n                if (!(!needDownload && subItem.selected)) {\n                  _context3.next = 9;\n                  break;\n                }\n\n                _context3.next = 9;\n                return this.removeDownloadBook(subItem).then(function () {\n                  subItem.cache = needDownload;\n                });\n\n              case 9:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function downloadItem(_x2, _x3) {\n        return _downloadItem.apply(this, arguments);\n      }\n\n      return downloadItem;\n    }(),\n    setPrivate: function setPrivate(v) {\n      this.bookList.forEach(function (item) {\n        if (item.selected) {\n          item.private = v;\n        }\n\n        if (item.itemList) {\n          item.itemList.forEach(function (subItem) {\n            if (subItem.selected) {\n              subItem.private = v;\n            }\n          });\n        }\n      });\n      this.onEditClick(false);\n      this.saveBookShelfToLocalStorage();\n\n      if (v) {\n        this.showToast(this.$t('shelf.setPrivateSuccess'));\n      } else {\n        this.showToast(this.$t('shelf.closePrivateSuccess'));\n      }\n    },\n    onEditClick: function onEditClick(v) {\n      var _this3 = this;\n\n      this.isEditMode = v;\n\n      if (!this.isEditMode) {\n        this.bookList.forEach(function (item) {\n          if (item.bookId) {\n            item.selected = false;\n          } else if (item.itemList) {\n            item.itemList.forEach(function (subItem) {\n              subItem.selected = false;\n            });\n          }\n        });\n      }\n\n      if (this.isEditMode) {\n        this.scrollBottom = 48;\n        this.$nextTick(function () {\n          if (_this3.$refs.scroll) {\n            _this3.$refs.scroll.refresh();\n          }\n        });\n      } else {\n        this.scrollBottom = 0;\n        this.$nextTick(function () {\n          if (_this3.$refs.scroll) {\n            _this3.$refs.scroll.refresh();\n          }\n        });\n      }\n    },\n    onScroll: function onScroll(offsetY) {\n      if (offsetY > 0) {\n        this.$refs.shelfTitle.showShadow();\n      } else {\n        this.$refs.shelfTitle.hideShadow();\n      }\n    },\n    getBookList: function getBookList() {\n      this.bookList = this.getBookShelfFromLocalStorage();\n    },\n    getCategoryList: function getCategoryList() {\n      this.index = this.$route.query.index;\n      this.category = this.bookList[this.index];\n      console.log(this.category);\n    },\n    saveBookShelfToLocalStorage: function saveBookShelfToLocalStorage() {\n      setLocalStorage(BOOK_SHELF_KEY, this.bookList);\n    },\n    getBookShelfFromLocalStorage: function getBookShelfFromLocalStorage() {\n      return getLocalStorage(BOOK_SHELF_KEY);\n    }\n  },\n  mounted: function mounted() {\n    this.getBookList();\n    this.getCategoryList();\n  }\n};",{"version":3,"sources":["bookCategory.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"book-category\">\n    <shelf-title class=\"shelf-title\"\n                 :title=\"category.title\"\n                 :isEditMode.sync=\"isEditMode\"\n                 :ifShowBack=\"ifShowBack\"\n                 :ifShowClear=\"ifShowClear\"\n                 :ifGroupEmpty=\"isEmpty\"\n                 :data=\"bookList\"\n                 :category=\"category\"\n                 @onEditClick=\"onEditClick\"\n                 @deleteGroup=\"deleteGroup\"\n                 @editGroupName=\"editGroupName\"\n                 ref=\"shelfTitle\"></shelf-title>\n    <scroll-view class=\"book-shelf-scroll-wrapper\"\n                 :top=\"42\"\n                 :bottom=\"scrollBottom\"\n                 @onScroll=\"onScroll\"\n                 ref=\"scroll\"\n                 v-if=\"!isEmpty\">\n      <book-shelf class=\"book-shelf-list\"\n                  :data=\"category.itemList\"\n                  :isEditMode=\"isEditMode\"\n                  @onBookClick=\"onBookClick\"\n                  ref=\"bookShelf\"></book-shelf>\n    </scroll-view>\n    <book-shelf-footer class=\"book-shelf-footer\"\n                       :data=\"category.itemList\"\n                       :bookList=\"bookList\"\n                       :isInGroup=\"true\"\n                       :category=\"category\"\n                       @setPrivate=\"setPrivate\"\n                       @setDownload=\"setDownload\"\n                       @removeBook=\"removeBook\"\n                       @groupEdit=\"groupEdit\"\n                       v-if=\"isEditMode && !isEmpty\"></book-shelf-footer>\n    <toast :text=\"toastText\" ref=\"toast\"></toast>\n    <div class=\"shelf-empty-view\" v-if=\"isEmpty\">\n      <span class=\"shelf-empty-text\">{{$t('shelf.groupNone')}}</span>\n    </div>\n  </div>\n</template>\n\n<script>\n  import ShelfTitle from '@/components/shelf/shelfTitle'\n  import BookShelf from '@/components/shelf/shelf'\n  import ScrollView from '@/components/Scroll'\n  import BookShelfFooter from '@/components/shelf/bookShelfFooter'\n  import Toast from '@/components/shelf/toast'\n  import { getLocalStorage, setLocalStorage } from '@/utils/localStorage'\n  import { getLocalForage, removeLocalForage } from '@/utils/localForage'\n  import { download } from '@/api/book'\n  import Epub from 'epubjs'\n\n  global.ePub = Epub\n\n  const BOOK_SHELF_KEY = 'bookShelf'\n\n  export default {\n    components: {\n      ShelfTitle,\n      ScrollView,\n      BookShelf,\n      BookShelfFooter,\n      Toast\n    },\n    computed: {\n      isEmpty() {\n        if (this.category && this.category.itemList && this.category.itemList.length > 0) {\n          return false\n        } else {\n          return true\n        }\n      }\n    },\n    data() {\n      return {\n        index: null,\n        bookList: [],\n        category: {},\n        isEditMode: false,\n        ifShowBack: true,\n        ifShowClear: false,\n        scrollBottom: 0,\n        toastText: ''\n      }\n    },\n    methods: {\n      editGroupName(category, groupName) {\n        category.title = groupName\n        this.onEditClick(false)\n        this.saveBookShelfToLocalStorage()\n      },\n      deleteGroup(category) {\n        const itemList = this.getBooksFromCategory(category)\n        this.removeCategory(category)\n        this.clearAddFromBookList()\n        this.appendBookToList(itemList)\n        this.appendAddToBookList()\n        this.onEditClick(false)\n        this.saveBookShelfToLocalStorage()\n        this.$router.go(-1)\n      },\n      removeCategory(category) {\n        this.bookList = this.bookList.filter(item => {\n          return category.id !== item.id\n        })\n      },\n      getBooksFromCategory(category) {\n        return category.itemList\n      },\n      groupEdit(operation, group) {\n        switch (operation) {\n          case 1:\n            this.moveToGroup(group)\n            break\n          case 2:\n            this.newGroup(group)\n            this.moveToGroup(group)\n            break\n          case 3:\n            this.moveOutGroup()\n            break\n        }\n      },\n      getSelectedBooks() {\n        const selectedBooks = this.bookList.filter(item => {\n          return item.selected\n        })\n        this.bookList.filter(item => {\n          if (item.type === 2 && item.itemList) {\n            item.itemList.filter(subItem => {\n              if (subItem.selected) {\n                selectedBooks.push(subItem)\n              }\n            })\n          }\n        })\n        return selectedBooks\n      },\n      clearSelectedBooks() {\n        this.bookList = this.bookList.filter(item => {\n          return !item.selected\n        })\n        this.bookList.forEach(item => {\n          if (item.type === 2 && item.itemList) {\n            item.itemList = item.itemList.filter(subItem => {\n              return !subItem.selected\n            })\n          }\n        })\n      },\n      appendBookToList(selectedBooks) {\n        let id = this.bookList[this.bookList.length - 1].id + 1\n        selectedBooks.forEach(item => {\n          item.id = id++\n          this.bookList.push(item)\n        })\n      },\n      moveOutGroup() {\n        this.clearAddFromBookList()\n        const selectedBooks = this.getSelectedBooks()\n        this.clearSelectedBooks()\n        this.appendBookToList(selectedBooks)\n        this.appendAddToBookList()\n        this.onEditClick(false)\n        this.saveBookShelfToLocalStorage()\n        this.showToast(this.$t('shelf.moveBookOutSuccess'))\n      },\n      newGroup(group) {\n        this.clearAddFromBookList()\n        this.bookList.push(group)\n        this.appendAddToBookList()\n      },\n      moveToGroup(group) {\n        const selectedBooks = this.getSelectedBooks()\n        this.clearSelectedBooks()\n        if (group && group.itemList) {\n          group.itemList = [...group.itemList, ...selectedBooks]\n          group.itemList.forEach((item, index) => {\n            item.id = index + 1\n          })\n        }\n        this.onEditClick(false)\n        this.saveBookShelfToLocalStorage()\n        this.showToast(this.$t('shelf.moveBookInSuccess').replace('$1', group.title))\n      },\n      appendAddToBookList() {\n        this.bookList.push({\n          cover: '',\n          title: '',\n          type: 3,\n          id: this.bookList[this.bookList.length - 1].id + 1\n        })\n      },\n      clearAddFromBookList() {\n        this.bookList = this.bookList.filter(item => {\n          return item.type !== 3\n        })\n      },\n      removeBook() {\n        this.bookList = this.bookList.filter(item => {\n          if (item.itemList) {\n            item.itemList = item.itemList.filter(subItem => {\n              return !subItem.selected\n            })\n          }\n          return !item.selected\n        })\n        this.onEditClick(false)\n        this.saveBookShelfToLocalStorage()\n      },\n      onBookClick(item, index) {\n        this.$router.push({\n          path: '/book-store/detail',\n          query: {\n            fileName: item.fileName,\n            category: item.categoryText\n          }\n        })\n      },\n      showToast(text) {\n        this.toastText = text\n        this.$refs.toast.show()\n      },\n      removeDownloadBook(item) {\n        return new Promise((resolve, reject) => {\n          removeLocalForage(item.fileName, () => {\n            console.log(`[${item.fileName}]删除成功...`)\n            resolve()\n          }, reject)\n        })\n      },\n      downloadBook(item) {\n        return new Promise((resolve, reject) => {\n          getLocalForage(item.fileName, (err, value) => {\n            if (!err && value instanceof Blob) {\n              console.log(`[${item.fileName}]读取成功...`, value, new Epub(value))\n              resolve()\n            } else {\n              download(item, item => {\n                console.log('[' + item.fileName + ']下载成功...')\n                resolve()\n              }, reject, reject)\n            }\n          })\n        })\n      },\n      async setDownload(needDownload) {\n        if (needDownload) {\n          this.showToast(this.$t('shelf.setDownloadSuccess'))\n        } else {\n          this.showToast(this.$t('shelf.removeDownloadSuccess'))\n        }\n        for (let i = 0; i < this.bookList.length; i++) {\n          const item = this.bookList[i]\n          if (needDownload && item.selected) {\n            console.log(`item-正在处理第${i + 1}本书`)\n            await this.downloadBook(item).then(() => {\n              item.cache = needDownload\n            })\n          } else if (!needDownload && item.selected) {\n            console.log(`item-正在处理第${i + 1}本书`)\n            await this.removeDownloadBook(item).then(() => {\n              item.cache = needDownload\n            })\n          }\n          if (item.itemList) {\n            for (let i = 0; i < item.itemList.length; i++) {\n              await this.downloadItem(item.itemList[i], needDownload)\n            }\n          }\n        }\n        this.onEditClick(false)\n        this.saveBookShelfToLocalStorage()\n        console.log('数据保存成功...')\n      },\n      async downloadItem(subItem, needDownload) {\n        console.log(`subItem-正在处理${subItem.fileName}`)\n        if (needDownload && subItem.selected) {\n          await this.downloadBook(subItem).then(() => {\n            subItem.cache = needDownload\n          })\n        } else if (!needDownload && subItem.selected) {\n          await this.removeDownloadBook(subItem).then(() => {\n            subItem.cache = needDownload\n          })\n        }\n      },\n      setPrivate(v) {\n        this.bookList.forEach(item => {\n          if (item.selected) {\n            item.private = v\n          }\n          if (item.itemList) {\n            item.itemList.forEach(subItem => {\n              if (subItem.selected) {\n                subItem.private = v\n              }\n            })\n          }\n        })\n        this.onEditClick(false)\n        this.saveBookShelfToLocalStorage()\n        if (v) {\n          this.showToast(this.$t('shelf.setPrivateSuccess'))\n        } else {\n          this.showToast(this.$t('shelf.closePrivateSuccess'))\n        }\n      },\n      onEditClick(v) {\n        this.isEditMode = v\n        if (!this.isEditMode) {\n          this.bookList.forEach(item => {\n            if (item.bookId) {\n              item.selected = false\n            } else if (item.itemList) {\n              item.itemList.forEach(subItem => {\n                subItem.selected = false\n              })\n            }\n          })\n        }\n        if (this.isEditMode) {\n          this.scrollBottom = 48\n          this.$nextTick(() => {\n            if (this.$refs.scroll) {\n              this.$refs.scroll.refresh()\n            }\n          })\n        } else {\n          this.scrollBottom = 0\n          this.$nextTick(() => {\n            if (this.$refs.scroll) {\n              this.$refs.scroll.refresh()\n            }\n          })\n        }\n      },\n      onScroll(offsetY) {\n        if (offsetY > 0) {\n          this.$refs.shelfTitle.showShadow()\n        } else {\n          this.$refs.shelfTitle.hideShadow()\n        }\n      },\n      getBookList() {\n        this.bookList = this.getBookShelfFromLocalStorage()\n      },\n      getCategoryList() {\n        this.index = this.$route.query.index\n        this.category = this.bookList[this.index]\n        console.log(this.category)\n      },\n      saveBookShelfToLocalStorage() {\n        setLocalStorage(BOOK_SHELF_KEY, this.bookList)\n      },\n      getBookShelfFromLocalStorage() {\n        return getLocalStorage(BOOK_SHELF_KEY)\n      }\n    },\n    mounted() {\n      this.getBookList()\n      this.getCategoryList()\n    }\n  }\n</script>\n\n<style lang=\"scss\" rel=\"stylesheet/scss\" scoped>\n  @import \"../../assets/styles/global\";\n\n  .book-category {\n    position: relative;\n    z-index: 100;\n    width: 100%;\n    height: 100%;\n    background: white;\n    .shelf-empty-view {\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      @include center;\n      font-size: px2rem(14);\n      color: #333;\n    }\n  }\n</style>\n"],"sourceRoot":"src/views/store"}]}