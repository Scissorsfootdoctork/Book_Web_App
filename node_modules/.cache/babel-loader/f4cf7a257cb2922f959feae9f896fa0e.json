{"remainingRequest":"/Users/kscissorfootdoctor/Desktop/Book_Web_App/node_modules/babel-loader/lib/index.js!/Users/kscissorfootdoctor/Desktop/Book_Web_App/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/kscissorfootdoctor/Desktop/Book_Web_App/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/kscissorfootdoctor/Desktop/Book_Web_App/src/views/store/bookShelf.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/kscissorfootdoctor/Desktop/Book_Web_App/src/views/store/bookShelf.vue","mtime":1541580605000},{"path":"/Users/kscissorfootdoctor/Desktop/Book_Web_App/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/kscissorfootdoctor/Desktop/Book_Web_App/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/kscissorfootdoctor/Desktop/Book_Web_App/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/kscissorfootdoctor/Desktop/Book_Web_App/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"/Users/kscissorfootdoctor/Desktop/Book_Web_App/node_modules/@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport \"core-js/modules/es6.number.constructor\";\nimport \"core-js/modules/es6.number.max-safe-integer\";\nimport \"core-js/modules/es6.regexp.replace\";\nimport _toConsumableArray from \"/Users/kscissorfootdoctor/Desktop/Book_Web_App/node_modules/@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.array.for-each\";\nimport \"core-js/modules/es6.array.filter\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport ShelfTitle from '@/components/shelf/shelfTitle';\nimport ShelfSearch from '@/components/shelf/shelfSearch';\nimport BookShelf from '@/components/shelf/shelf';\nimport ScrollView from '@/components/Scroll';\nimport BookShelfFooter from '@/components/shelf/bookShelfFooter';\nimport BookShelfEmpty from '@/components/shelf/bookShelfEmpty';\nimport Toast from '@/components/shelf/toast';\nimport { shelf, download } from '@/api/book';\nimport { getLocalStorage, setLocalStorage, clearLocalStorage } from '@/utils/localStorage';\nimport { getLocalForage, clearLocalForage } from '@/utils/localForage';\nimport { removeBookCache } from '@/utils/book';\nimport Epub from 'epubjs';\nimport { realPx } from '@/utils/utils';\nglobal.ePub = Epub;\nvar BOOK_SHELF_KEY = 'bookShelf';\nexport default {\n  components: {\n    ShelfTitle: ShelfTitle,\n    ShelfSearch: ShelfSearch,\n    BookShelf: BookShelf,\n    ScrollView: ScrollView,\n    BookShelfFooter: BookShelfFooter,\n    BookShelfEmpty: BookShelfEmpty,\n    Toast: Toast\n  },\n  computed: {\n    isDataEmpty: function isDataEmpty() {\n      return !this.bookList || this.bookList.filter(function (item) {\n        return item.type !== 3;\n      }).length === 0;\n    }\n  },\n  data: function data() {\n    return {\n      bookList: [],\n      ifShowTitle: true,\n      isEditMode: false,\n      ifShowBack: false,\n      ifShowClear: true,\n      scrollBottom: 0,\n      toastText: '',\n      showType: 0,\n      initPosition: {\n        x: 0,\n        y: 0\n      }\n    };\n  },\n  methods: {\n    onSearchTabClick: function onSearchTabClick(id) {\n      this.showType = id;\n    },\n    groupEdit: function groupEdit(operation, group) {\n      switch (operation) {\n        case 1:\n          this.moveToGroup(group);\n          break;\n\n        case 2:\n          this.newGroup(group);\n          this.moveToGroup(group);\n          break;\n\n        case 3:\n          this.moveOutGroup();\n          break;\n      }\n    },\n    getSelectedBooks: function getSelectedBooks() {\n      var selectedBooks = this.bookList.filter(function (item) {\n        return item.selected;\n      });\n      this.bookList.filter(function (item) {\n        if (item.type === 2 && item.itemList) {\n          item.itemList.filter(function (subItem) {\n            if (subItem.selected) {\n              selectedBooks.push(subItem);\n            }\n          });\n        }\n      });\n      return selectedBooks;\n    },\n    clearSelectedBooks: function clearSelectedBooks() {\n      this.bookList = this.bookList.filter(function (item) {\n        return !item.selected;\n      });\n      this.bookList.forEach(function (item) {\n        if (item.type === 2 && item.itemList) {\n          item.itemList = item.itemList.filter(function (subItem) {\n            return !subItem.selected;\n          });\n        }\n      });\n    },\n    appendBookToList: function appendBookToList(selectedBooks) {\n      var _this = this;\n\n      var id = this.bookList[this.bookList.length - 1].id + 1;\n      selectedBooks.forEach(function (item) {\n        item.id = id++;\n\n        _this.bookList.push(item);\n      });\n    },\n    moveOutGroup: function moveOutGroup() {\n      this.clearAddFromBookList();\n      var selectedBooks = this.getSelectedBooks();\n      this.clearSelectedBooks();\n      this.appendBookToList(selectedBooks);\n      this.appendAddToBookList();\n      this.onEditClick(false);\n      this.saveBookShelfToLocalStorage();\n      this.showToast(this.$t('shelf.moveBookOutSuccess'));\n    },\n    newGroup: function newGroup(group) {\n      this.clearAddFromBookList();\n      this.bookList.push(group);\n      this.appendAddToBookList();\n    },\n    moveToGroup: function moveToGroup(group) {\n      var selectedBooks = this.getSelectedBooks();\n      this.clearSelectedBooks();\n\n      if (group && group.itemList) {\n        group.itemList = [].concat(_toConsumableArray(group.itemList), _toConsumableArray(selectedBooks));\n        group.itemList.forEach(function (item, index) {\n          item.id = index + 1;\n        });\n      }\n\n      this.onEditClick(false);\n      this.saveBookShelfToLocalStorage();\n      this.showToast(this.$t('shelf.moveBookInSuccess').replace('$1', group.title));\n    },\n    appendAddToBookList: function appendAddToBookList() {\n      this.bookList.push({\n        cover: '',\n        title: '',\n        type: 3,\n        // id: this.bookList[this.bookList.length - 1].id + 1\n        id: Number.MAX_SAFE_INTEGER\n      });\n    },\n    clearAddFromBookList: function clearAddFromBookList() {\n      this.bookList = this.bookList.filter(function (item) {\n        return item.type !== 3;\n      });\n    },\n    removeBook: function removeBook() {\n      this.bookList = this.bookList.filter(function (item) {\n        if (item.itemList) {\n          item.itemList = item.itemList.filter(function (subItem) {\n            return !subItem.selected;\n          });\n        }\n\n        return !item.selected;\n      }); // this.$refs.bookShelf.showRemoveAnimation()\n\n      this.onEditClick(false);\n      this.saveBookShelfToLocalStorage();\n    },\n    clearCache: function clearCache() {\n      var _this2 = this;\n\n      clearLocalStorage();\n      clearLocalForage(function () {\n        console.log('清除localForage成功...');\n\n        _this2.getBookShelf();\n      });\n      this.showToast(this.$t('shelf.clearCacheSuccess'));\n    },\n    onBookClick: function onBookClick(item, index) {\n      this.$router.push({\n        path: '/book-store/detail',\n        query: {\n          fileName: item.fileName,\n          category: item.categoryText\n        }\n      });\n    },\n    showToast: function showToast(text) {\n      this.toastText = text;\n      this.$refs.toast.show();\n    },\n    hideToast: function hideToast() {\n      this.$refs.toast.hide();\n    },\n    showContinueToast: function showContinueToast(text) {\n      this.toastText = text;\n      this.$refs.toast.continueShow();\n    },\n    removeDownloadBook: function removeDownloadBook(item) {\n      return removeBookCache(item.fileName);\n    },\n    downloadBook: function downloadBook(item) {\n      var _this3 = this;\n\n      return new Promise(function (resolve, reject) {\n        getLocalForage(item.fileName, function (err, value) {\n          if (!err && value instanceof Blob) {\n            console.log(\"[\".concat(item.fileName, \"]\\u8BFB\\u53D6\\u6210\\u529F...\"), value, new Epub(value));\n            resolve();\n          } else {\n            download(item, function (item) {\n              console.log('[' + item.fileName + ']下载成功...');\n              resolve();\n            }, reject, reject, function (progressEvent) {\n              var progress = Math.floor(progressEvent.loaded / progressEvent.total * 100) + '%';\n              _this3.toastText = _this3.$t('shelf.progressDownload').replace('$1', \"\".concat(item.fileName, \".epub(\").concat(progress, \")\"));\n            });\n          }\n        });\n      });\n    },\n    setDownload: function () {\n      var _setDownload = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(needDownload) {\n        var _this4 = this;\n\n        var _loop, i;\n\n        return regeneratorRuntime.wrap(function _callee$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                this.showContinueToast(this.$t('shelf.startDownload'));\n                _loop = /*#__PURE__*/regeneratorRuntime.mark(function _loop(i) {\n                  var item, _i;\n\n                  return regeneratorRuntime.wrap(function _loop$(_context) {\n                    while (1) {\n                      switch (_context.prev = _context.next) {\n                        case 0:\n                          item = _this4.bookList[i];\n\n                          if (!(needDownload && item.selected)) {\n                            _context.next = 6;\n                            break;\n                          }\n\n                          _context.next = 4;\n                          return _this4.downloadBook(item).then(function () {\n                            item.cache = needDownload;\n                          });\n\n                        case 4:\n                          _context.next = 9;\n                          break;\n\n                        case 6:\n                          if (!(!needDownload && item.selected)) {\n                            _context.next = 9;\n                            break;\n                          }\n\n                          _context.next = 9;\n                          return _this4.removeDownloadBook(item).then(function () {\n                            item.cache = needDownload;\n                          });\n\n                        case 9:\n                          if (!item.itemList) {\n                            _context.next = 17;\n                            break;\n                          }\n\n                          _i = 0;\n\n                        case 11:\n                          if (!(_i < item.itemList.length)) {\n                            _context.next = 17;\n                            break;\n                          }\n\n                          _context.next = 14;\n                          return _this4.downloadItem(item.itemList[_i], needDownload);\n\n                        case 14:\n                          _i++;\n                          _context.next = 11;\n                          break;\n\n                        case 17:\n                        case \"end\":\n                          return _context.stop();\n                      }\n                    }\n                  }, _loop);\n                });\n                i = 0;\n\n              case 3:\n                if (!(i < this.bookList.length)) {\n                  _context2.next = 8;\n                  break;\n                }\n\n                return _context2.delegateYield(_loop(i), \"t0\", 5);\n\n              case 5:\n                i++;\n                _context2.next = 3;\n                break;\n\n              case 8:\n                this.hideToast();\n\n                if (needDownload) {\n                  this.showToast(this.$t('shelf.setDownloadSuccess'));\n                } else {\n                  this.showToast(this.$t('shelf.removeDownloadSuccess'));\n                }\n\n                this.onEditClick(false);\n                this.saveBookShelfToLocalStorage();\n                console.log('数据保存成功...');\n\n              case 13:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function setDownload(_x) {\n        return _setDownload.apply(this, arguments);\n      }\n\n      return setDownload;\n    }(),\n    downloadItem: function () {\n      var _downloadItem = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2(subItem, needDownload) {\n        return regeneratorRuntime.wrap(function _callee2$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                if (!(needDownload && subItem.selected)) {\n                  _context3.next = 5;\n                  break;\n                }\n\n                _context3.next = 3;\n                return this.downloadBook(subItem).then(function () {\n                  subItem.cache = needDownload;\n                });\n\n              case 3:\n                _context3.next = 8;\n                break;\n\n              case 5:\n                if (!(!needDownload && subItem.selected)) {\n                  _context3.next = 8;\n                  break;\n                }\n\n                _context3.next = 8;\n                return this.removeDownloadBook(subItem).then(function () {\n                  subItem.cache = needDownload;\n                });\n\n              case 8:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function downloadItem(_x2, _x3) {\n        return _downloadItem.apply(this, arguments);\n      }\n\n      return downloadItem;\n    }(),\n    setPrivate: function setPrivate(v) {\n      this.bookList.forEach(function (item) {\n        if (item.selected) {\n          item.private = v;\n        }\n      });\n      this.onEditClick(false);\n      this.saveBookShelfToLocalStorage();\n\n      if (v) {\n        this.showToast(this.$t('shelf.setPrivateSuccess'));\n      } else {\n        this.showToast(this.$t('shelf.closePrivateSuccess'));\n      }\n    },\n    onEditClick: function onEditClick(v) {\n      var _this5 = this;\n\n      this.isEditMode = v;\n\n      if (!this.isEditMode) {\n        this.bookList.forEach(function (item) {\n          if (item.bookId) {\n            item.selected = false;\n          } else if (item.itemList) {\n            item.itemList.forEach(function (subItem) {\n              subItem.selected = false;\n            });\n          }\n        });\n      }\n\n      if (this.isEditMode) {\n        this.scrollBottom = 48;\n        this.$nextTick(function () {\n          if (_this5.$refs.scroll) {\n            _this5.$refs.scroll.refresh();\n          }\n        });\n      } else {\n        this.scrollBottom = 0;\n        this.$nextTick(function () {\n          if (_this5.$refs.scroll) {\n            _this5.$refs.scroll.refresh();\n          }\n        });\n      }\n    },\n    onSearchClick: function onSearchClick() {\n      this.onEditClick(false);\n      this.showType = 1;\n      this.hideTitle();\n    },\n    onSearchCancel: function onSearchCancel() {\n      this.showTitle();\n      this.showType = 0;\n      this.$refs.scroll.scrollTo(0, 0);\n    },\n    showTitle: function showTitle() {\n      this.ifShowTitle = true;\n    },\n    hideTitle: function hideTitle() {\n      this.ifShowTitle = false;\n    },\n    onScroll: function onScroll(offsetY) {\n      if (offsetY > realPx(54)) {\n        this.$refs.shelfTitle.showShadow();\n\n        if (!this.ifShowTitle) {\n          this.$refs.shelfSearch.showShadow();\n        }\n      } else {\n        this.$refs.shelfTitle.hideShadow();\n\n        if (this.$refs.shelfSearch) {\n          this.$refs.shelfSearch.hideShadow();\n        }\n      }\n    },\n    getBookShelf: function getBookShelf() {\n      var _this6 = this;\n\n      this.bookList = this.getBookShelfFromLocalStorage();\n\n      if (!this.bookList) {\n        shelf().then(function (response) {\n          _this6.bookList = response.data.bookList;\n\n          if (!_this6.bookList) {\n            _this6.bookList = [];\n          }\n\n          _this6.appendAddToBookList();\n\n          _this6.saveBookShelfToLocalStorage();\n\n          _this6.initBookShelf();\n        });\n      }\n\n      this.initBookShelf();\n    },\n    initBookShelf: function initBookShelf() {\n      if (this.bookList) {\n        this.bookList.forEach(function (item) {\n          item.selected = false;\n        });\n      }\n    },\n    saveBookShelfToLocalStorage: function saveBookShelfToLocalStorage() {\n      setLocalStorage(BOOK_SHELF_KEY, this.bookList);\n    },\n    getBookShelfFromLocalStorage: function getBookShelfFromLocalStorage() {\n      return getLocalStorage(BOOK_SHELF_KEY);\n    }\n  },\n  mounted: function mounted() {\n    this.getBookShelf();\n  }\n};",{"version":3,"sources":["bookShelf.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"book-shelf\">\n    <shelf-title class=\"shelf-title\"\n                 :title=\"$t('shelf.title')\"\n                 :isEditMode.sync=\"isEditMode\"\n                 :data=\"bookList\"\n                 :ifShowBack=\"ifShowBack\"\n                 :ifShowClear=\"ifShowClear\"\n                 @onEditClick=\"onEditClick\"\n                 @clearCache=\"clearCache\"\n                 ref=\"shelfTitle\"\n                 v-show=\"ifShowTitle\"></shelf-title>\n    <scroll-view class=\"book-shelf-scroll-wrapper\"\n                 :top=\"0\"\n                 :bottom=\"scrollBottom\"\n                 :initPosition=\"initPosition\"\n                 @onScroll=\"onScroll\"\n                 ref=\"scroll\">\n      <shelf-search @onSearchClick=\"onSearchClick\"\n                    @onCancel=\"onSearchCancel\"\n                    @onTabClick=\"onSearchTabClick\"\n                    ref=\"shelfSearch\"\n                    v-if=\"!isDataEmpty\"></shelf-search>\n      <book-shelf class=\"book-shelf-list\"\n                  :data=\"bookList\"\n                  :showType=\"showType\"\n                  :isEditMode=\"isEditMode\"\n                  @onBookClick=\"onBookClick\"\n                  ref=\"bookShelf\"\n                  v-if=\"!isDataEmpty\"></book-shelf>\n      <book-shelf-empty\n                  class=\"book-shelf-empty\"\n                  v-if=\"isDataEmpty\"></book-shelf-empty>\n    </scroll-view>\n    <book-shelf-footer class=\"book-shelf-footer\"\n                       :data=\"bookList\"\n                       :bookList=\"bookList\"\n                       :isInGroup=\"false\"\n                       @setPrivate=\"setPrivate\"\n                       @setDownload=\"setDownload\"\n                       @removeBook=\"removeBook\"\n                       @groupEdit=\"groupEdit\"\n                       v-show=\"isEditMode\"></book-shelf-footer>\n    <toast :text=\"toastText\" ref=\"toast\"></toast>\n  </div>\n</template>\n\n<script type=\"text/ecmascript-6\">\n  import ShelfTitle from '@/components/shelf/shelfTitle'\n  import ShelfSearch from '@/components/shelf/shelfSearch'\n  import BookShelf from '@/components/shelf/shelf'\n  import ScrollView from '@/components/Scroll'\n  import BookShelfFooter from '@/components/shelf/bookShelfFooter'\n  import BookShelfEmpty from '@/components/shelf/bookShelfEmpty'\n  import Toast from '@/components/shelf/toast'\n  import { shelf, download } from '@/api/book'\n  import { getLocalStorage, setLocalStorage, clearLocalStorage } from '@/utils/localStorage'\n  import { getLocalForage, clearLocalForage } from '@/utils/localForage'\n  import { removeBookCache } from '@/utils/book'\n  import Epub from 'epubjs'\n  import { realPx } from '@/utils/utils'\n\n  global.ePub = Epub\n\n  const BOOK_SHELF_KEY = 'bookShelf'\n  export default {\n    components: {\n      ShelfTitle,\n      ShelfSearch,\n      BookShelf,\n      ScrollView,\n      BookShelfFooter,\n      BookShelfEmpty,\n      Toast\n    },\n    computed: {\n      isDataEmpty() {\n        return !this.bookList || this.bookList.filter(item => item.type !== 3).length === 0\n      }\n    },\n    data() {\n      return {\n        bookList: [],\n        ifShowTitle: true,\n        isEditMode: false,\n        ifShowBack: false,\n        ifShowClear: true,\n        scrollBottom: 0,\n        toastText: '',\n        showType: 0,\n        initPosition: {\n          x: 0,\n          y: 0\n        }\n      }\n    },\n    methods: {\n      onSearchTabClick(id) {\n        this.showType = id\n      },\n      groupEdit(operation, group) {\n        switch (operation) {\n          case 1:\n            this.moveToGroup(group)\n            break\n          case 2:\n            this.newGroup(group)\n            this.moveToGroup(group)\n            break\n          case 3:\n            this.moveOutGroup()\n            break\n        }\n      },\n      getSelectedBooks() {\n        const selectedBooks = this.bookList.filter(item => {\n          return item.selected\n        })\n        this.bookList.filter(item => {\n          if (item.type === 2 && item.itemList) {\n            item.itemList.filter(subItem => {\n              if (subItem.selected) {\n                selectedBooks.push(subItem)\n              }\n            })\n          }\n        })\n        return selectedBooks\n      },\n      clearSelectedBooks() {\n        this.bookList = this.bookList.filter(item => {\n          return !item.selected\n        })\n        this.bookList.forEach(item => {\n          if (item.type === 2 && item.itemList) {\n            item.itemList = item.itemList.filter(subItem => {\n              return !subItem.selected\n            })\n          }\n        })\n      },\n      appendBookToList(selectedBooks) {\n        let id = this.bookList[this.bookList.length - 1].id + 1\n        selectedBooks.forEach(item => {\n          item.id = id++\n          this.bookList.push(item)\n        })\n      },\n      moveOutGroup() {\n        this.clearAddFromBookList()\n        const selectedBooks = this.getSelectedBooks()\n        this.clearSelectedBooks()\n        this.appendBookToList(selectedBooks)\n        this.appendAddToBookList()\n        this.onEditClick(false)\n        this.saveBookShelfToLocalStorage()\n        this.showToast(this.$t('shelf.moveBookOutSuccess'))\n      },\n      newGroup(group) {\n        this.clearAddFromBookList()\n        this.bookList.push(group)\n        this.appendAddToBookList()\n      },\n      moveToGroup(group) {\n        const selectedBooks = this.getSelectedBooks()\n        this.clearSelectedBooks()\n        if (group && group.itemList) {\n          group.itemList = [...group.itemList, ...selectedBooks]\n          group.itemList.forEach((item, index) => {\n            item.id = index + 1\n          })\n        }\n        this.onEditClick(false)\n        this.saveBookShelfToLocalStorage()\n        this.showToast(this.$t('shelf.moveBookInSuccess').replace('$1', group.title))\n      },\n      appendAddToBookList() {\n        this.bookList.push({\n          cover: '',\n          title: '',\n          type: 3,\n          // id: this.bookList[this.bookList.length - 1].id + 1\n          id: Number.MAX_SAFE_INTEGER\n        })\n      },\n      clearAddFromBookList() {\n        this.bookList = this.bookList.filter(item => {\n          return item.type !== 3\n        })\n      },\n      removeBook() {\n        this.bookList = this.bookList.filter(item => {\n          if (item.itemList) {\n            item.itemList = item.itemList.filter(subItem => {\n              return !subItem.selected\n            })\n          }\n          return !item.selected\n        })\n        // this.$refs.bookShelf.showRemoveAnimation()\n        this.onEditClick(false)\n        this.saveBookShelfToLocalStorage()\n      },\n      clearCache() {\n        clearLocalStorage()\n        clearLocalForage(() => {\n          console.log('清除localForage成功...')\n          this.getBookShelf()\n        })\n        this.showToast(this.$t('shelf.clearCacheSuccess'))\n      },\n      onBookClick(item, index) {\n        this.$router.push({\n          path: '/book-store/detail',\n          query: {\n            fileName: item.fileName,\n            category: item.categoryText\n          }\n        })\n      },\n      showToast(text) {\n        this.toastText = text\n        this.$refs.toast.show()\n      },\n      hideToast() {\n        this.$refs.toast.hide()\n      },\n      showContinueToast(text) {\n        this.toastText = text\n        this.$refs.toast.continueShow()\n      },\n      removeDownloadBook(item) {\n        return removeBookCache(item.fileName)\n      },\n      downloadBook(item) {\n        return new Promise((resolve, reject) => {\n          getLocalForage(item.fileName, (err, value) => {\n            if (!err && value instanceof Blob) {\n              console.log(`[${item.fileName}]读取成功...`, value, new Epub(value))\n              resolve()\n            } else {\n              download(item, item => {\n                console.log('[' + item.fileName + ']下载成功...')\n                resolve()\n              }, reject, reject, progressEvent => {\n                const progress = Math.floor(progressEvent.loaded / progressEvent.total * 100) + '%'\n                this.toastText = this.$t('shelf.progressDownload').replace('$1', `${item.fileName}.epub(${progress})`)\n              })\n            }\n          })\n        })\n      },\n      async setDownload(needDownload) {\n        this.showContinueToast(this.$t('shelf.startDownload'))\n        for (let i = 0; i < this.bookList.length; i++) {\n          const item = this.bookList[i]\n          if (needDownload && item.selected) {\n            await this.downloadBook(item).then(() => {\n              item.cache = needDownload\n            })\n          } else if (!needDownload && item.selected) {\n            await this.removeDownloadBook(item).then(() => {\n              item.cache = needDownload\n            })\n          }\n          if (item.itemList) {\n            for (let i = 0; i < item.itemList.length; i++) {\n              await this.downloadItem(item.itemList[i], needDownload)\n            }\n          }\n        }\n        this.hideToast()\n        if (needDownload) {\n          this.showToast(this.$t('shelf.setDownloadSuccess'))\n        } else {\n          this.showToast(this.$t('shelf.removeDownloadSuccess'))\n        }\n        this.onEditClick(false)\n        this.saveBookShelfToLocalStorage()\n        console.log('数据保存成功...')\n      },\n      async downloadItem(subItem, needDownload) {\n        if (needDownload && subItem.selected) {\n          await this.downloadBook(subItem).then(() => {\n            subItem.cache = needDownload\n          })\n        } else if (!needDownload && subItem.selected) {\n          await this.removeDownloadBook(subItem).then(() => {\n            subItem.cache = needDownload\n          })\n        }\n      },\n      setPrivate(v) {\n        this.bookList.forEach(item => {\n          if (item.selected) {\n            item.private = v\n          }\n        })\n        this.onEditClick(false)\n        this.saveBookShelfToLocalStorage()\n        if (v) {\n          this.showToast(this.$t('shelf.setPrivateSuccess'))\n        } else {\n          this.showToast(this.$t('shelf.closePrivateSuccess'))\n        }\n      },\n      onEditClick(v) {\n        this.isEditMode = v\n        if (!this.isEditMode) {\n          this.bookList.forEach(item => {\n            if (item.bookId) {\n              item.selected = false\n            } else if (item.itemList) {\n              item.itemList.forEach(subItem => {\n                subItem.selected = false\n              })\n            }\n          })\n        }\n        if (this.isEditMode) {\n          this.scrollBottom = 48\n          this.$nextTick(() => {\n            if (this.$refs.scroll) {\n              this.$refs.scroll.refresh()\n            }\n          })\n        } else {\n          this.scrollBottom = 0\n          this.$nextTick(() => {\n            if (this.$refs.scroll) {\n              this.$refs.scroll.refresh()\n            }\n          })\n        }\n      },\n      onSearchClick() {\n        this.onEditClick(false)\n        this.showType = 1\n        this.hideTitle()\n      },\n      onSearchCancel() {\n        this.showTitle()\n        this.showType = 0\n        this.$refs.scroll.scrollTo(0, 0)\n      },\n      showTitle() {\n        this.ifShowTitle = true\n      },\n      hideTitle() {\n        this.ifShowTitle = false\n      },\n      onScroll(offsetY) {\n        if (offsetY > realPx(54)) {\n          this.$refs.shelfTitle.showShadow()\n          if (!this.ifShowTitle) {\n            this.$refs.shelfSearch.showShadow()\n          }\n        } else {\n          this.$refs.shelfTitle.hideShadow()\n          if (this.$refs.shelfSearch) {\n            this.$refs.shelfSearch.hideShadow()\n          }\n        }\n      },\n      getBookShelf() {\n        this.bookList = this.getBookShelfFromLocalStorage()\n        if (!this.bookList) {\n          shelf().then(response => {\n            this.bookList = response.data.bookList\n            if (!this.bookList) {\n              this.bookList = []\n            }\n            this.appendAddToBookList()\n            this.saveBookShelfToLocalStorage()\n            this.initBookShelf()\n          })\n        }\n        this.initBookShelf()\n      },\n      initBookShelf() {\n        if (this.bookList) {\n          this.bookList.forEach(item => {\n            item.selected = false\n          })\n        }\n      },\n      saveBookShelfToLocalStorage() {\n        setLocalStorage(BOOK_SHELF_KEY, this.bookList)\n      },\n      getBookShelfFromLocalStorage() {\n        return getLocalStorage(BOOK_SHELF_KEY)\n      }\n    },\n    mounted() {\n      this.getBookShelf()\n    }\n  }\n</script>\n\n<style lang=\"scss\" rel=\"stylesheet/scss\" scoped>\n  @import \"../../assets/styles/global\";\n\n  .book-shelf {\n    position: relative;\n    z-index: 100;\n    width: 100%;\n    height: 100%;\n    font-size: 0;\n    .shelf-title {\n      position: absolute;\n      left: 0;\n      top: 0;\n      z-index: 110;\n    }\n    .book-shelf-list {\n      position: absolute;\n      top: px2rem(93.5);\n      left: 0;\n      z-index: 100;\n    }\n    .book-shelf-empty {\n      position: absolute;\n      top: px2rem(42);\n      left: 0;\n      z-index: 100;\n    }\n    .book-shelf-scroll-wrapper {\n      position: absolute;\n      top: 0;\n      left: 0;\n      z-index: 101;\n      background: white;\n    }\n    .book-shelf-scroll-wrapper2 {\n      position: absolute;\n      top: px2rem(93.5);\n      left: 0;\n      z-index: 101;\n    }\n  }\n</style>\n"],"sourceRoot":"src/views/store"}]}